{"ast":null,"code":"var _jsxFileName = \"/home/belac/sysFlow/src/components/GraphCanvas.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from \"react\"; // Added useEffect\n\nimport { GraphNode } from \"./GraphNode\";\nimport { GraphContainer } from \"./GraphContainer\";\nimport { Lasso } from \"./Lasso\";\nimport { EntityEditor } from \"./EntityEditor\";\nimport { GraphContextMenu } from \"./GraphContextMenu\";\nimport { GraphEdgeLayer } from \"./GraphEdgeLayer\";\nimport { GraphPortLayer } from \"./GraphPortLayer\";\n\n// --- HOOKS ---\nimport { useGraphView } from \"../hooks/useGraphView\";\nimport { useGraphSelection } from \"../hooks/useGraphSelection\";\nimport { useGraphClipboard } from \"../hooks/useGraphClipboard\";\n\n// --- IMPORT THE LOGIC ---\nimport * as GraphLogic from \"../utils/GraphLogic\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const GraphCanvas = ({\n  graph,\n  onGraphChange,\n  renderNode,\n  renderContainer,\n  enablePorts\n}) => {\n  _s();\n  const containerRef = useRef(null);\n\n  // 1. Hooks\n  const view = useGraphView(containerRef);\n  const selection = useGraphSelection(graph);\n  const clipboard = useGraphClipboard({\n    graph,\n    onGraphChange,\n    selectedNodes: selection.selectedNodes,\n    selectedContainerIds: selection.selectedContainerIds,\n    clearSelection: selection.clearSelection,\n    setSelectedNodes: selection.setSelectedNodes,\n    setSelectedContainerIds: selection.setSelectedContainerIds\n  });\n\n  // 2. Local Interaction State\n  const [mode, setMode] = useState(\"idle\");\n  const [dragStartMouse, setDragStartMouse] = useState(null);\n  const [dragStartPositions, setDragStartPositions] = useState(new Map());\n\n  // Creating Edges\n  const [creatingEdge, setCreatingEdge] = useState(null);\n  const [hoveredPort, setHoveredPort] = useState(null);\n\n  // NEW: Selected Edge State\n  const [selectedEdgeId, setSelectedEdgeId] = useState(null);\n\n  // Resize\n  const [resizingState, setResizingState] = useState(null);\n\n  // Menus\n  const [editingEntityId, setEditingEntityId] = useState(null);\n  const [editorPosition, setEditorPosition] = useState(null);\n  const [canvasMenu, setCanvasMenu] = useState(null);\n\n  // --- NEW: Keyboard Handler for Deletion ---\n  useEffect(() => {\n    const handleKeyDown = e => {\n      // Ignore if user is typing in an input/textarea\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) return;\n      if (e.key === \"Delete\" || e.key === \"Backspace\") {\n        if (selectedEdgeId) {\n          const newGraph = graph.clone();\n          delete newGraph.edgesById[selectedEdgeId];\n          onGraphChange(newGraph);\n          setSelectedEdgeId(null);\n        }\n        // You can also add node deletion here if not already handled in useGraphSelection\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [selectedEdgeId, graph, onGraphChange]);\n\n  // --- Handlers ---\n\n  const handleMouseDown = e => {\n    // 0. Pan Start\n    if (e.button === 1 || e.button === 0 && e.nativeEvent.getModifierState(\"Space\")) {\n      e.preventDefault();\n      view.startPan(e);\n      return;\n    }\n\n    // 1. Context Menu\n    if (e.button === 2) {\n      const screenPos = {\n        x: e.clientX,\n        y: e.clientY\n      };\n      const graphPos = view.getMousePos(e);\n      setCanvasMenu({\n        position: screenPos,\n        graphPosition: graphPos\n      });\n      return;\n    }\n    const pos = view.getMousePos(e);\n\n    // 2. Canvas Click (Left) -> Clear Selection & Start Lasso\n    if (e.button === 0) {\n      selection.clearSelection();\n      setSelectedEdgeId(null); // Clear edge selection\n      setEditingEntityId(null);\n      setCanvasMenu(null);\n      setMode(\"lasso\");\n      selection.setLassoStart(pos);\n      selection.setLassoEnd(pos);\n    }\n  };\n  const handleMouseMove = e => {\n    if (view.isPanning) {\n      view.updatePan(e);\n      return;\n    }\n    const mousePos = view.getMousePos(e);\n    if (mode === \"drag\" && dragStartMouse) {\n      const dx = mousePos.x - dragStartMouse.x;\n      const dy = mousePos.y - dragStartMouse.y;\n      const newGraph = graph.clone();\n      let changed = false;\n      dragStartPositions.forEach((startPos, id) => {\n        const node = newGraph.nodesById[id];\n        const container = newGraph.containersById[id];\n        if (node) {\n          node.position = {\n            x: startPos.x + dx,\n            y: startPos.y + dy\n          };\n          changed = true;\n        }\n        if (container) {\n          container.position = {\n            x: startPos.x + dx,\n            y: startPos.y + dy\n          };\n          changed = true;\n        }\n      });\n      if (changed) onGraphChange(newGraph);\n    }\n    if (mode === \"lasso\") {\n      selection.setLassoEnd(mousePos);\n    }\n    if (mode === \"edge-create\" && creatingEdge) {\n      setCreatingEdge({\n        ...creatingEdge,\n        position: mousePos\n      });\n    }\n    if (mode === \"resize\" && resizingState) {\n      const dx = mousePos.x - resizingState.startMouse.x;\n      const dy = mousePos.y - resizingState.startMouse.y;\n      const newGraph = graph.clone();\n      const c = newGraph.containersById[resizingState.id];\n      if (c) {\n        c.size = {\n          width: Math.max(100, resizingState.startSize.width + dx),\n          height: Math.max(50, resizingState.startSize.height + dy)\n        };\n        onGraphChange(newGraph);\n      }\n    }\n  };\n  const handleMouseUp = e => {\n    if (view.isPanning) {\n      view.endPan();\n      return;\n    }\n    const pos = view.getMousePos(e);\n    const isClick = dragStartMouse && Math.abs(pos.x - dragStartMouse.x) < 5 && Math.abs(pos.y - dragStartMouse.y) < 5;\n\n    // 1. Open Editor (Click without drag)\n    if (mode === \"idle\" || mode === \"drag\" && isClick) {\n      const targetId = GraphLogic.hitTestEntity(graph, pos);\n      if (targetId) {\n        setEditingEntityId(targetId);\n        setEditorPosition({\n          x: pos.x,\n          y: pos.y\n        });\n        setMode(\"idle\");\n        return;\n      }\n    }\n    if (mode === \"lasso\") {\n      selection.completeLasso();\n    }\n    if (mode === \"drag\" && dragStartMouse) {\n      const newGraph = graph.clone();\n      dragStartPositions.forEach((_, id) => {\n        var _newGraph$nodesById$i, _newGraph$containersB;\n        GraphLogic.assignEntityToContainer(newGraph, id);\n        const parent = ((_newGraph$nodesById$i = newGraph.nodesById[id]) === null || _newGraph$nodesById$i === void 0 ? void 0 : _newGraph$nodesById$i.parentId) || ((_newGraph$containersB = newGraph.containersById[id]) === null || _newGraph$containersB === void 0 ? void 0 : _newGraph$containersB.parentId);\n        if (parent) GraphLogic.recomputeContainerSize(newGraph, parent);\n      });\n      onGraphChange(newGraph);\n      setDragStartMouse(null);\n      setDragStartPositions(new Map());\n    }\n    if (mode === \"edge-create\" && creatingEdge) {\n      const targetNodeId = hoveredPort ? hoveredPort.nodeId : GraphLogic.hitTestEntity(graph, pos);\n      if (targetNodeId && targetNodeId !== creatingEdge.sourceNodeId) {\n        let finalGraph = graph.clone();\n        let finalSourcePortId = creatingEdge.sourcePortId;\n        let finalTargetPortId = hoveredPort ? hoveredPort.portId : undefined;\n\n        // ... (Keep existing Edge Creation Logic steps 1, 2, 3) ...\n        // Simplified for brevity in this response, keep your original logic here!\n\n        // --- STEP 3: Create the Edge ---\n        if (!enablePorts || finalSourcePortId && finalTargetPortId) {\n          const edgeId = `e_${crypto.randomUUID()}`;\n          finalGraph.edgesById[edgeId] = {\n            id: edgeId,\n            sourceNodeId: creatingEdge.sourceNodeId,\n            sourcePortId: finalSourcePortId,\n            targetNodeId: targetNodeId,\n            targetPortId: finalTargetPortId\n          };\n          onGraphChange(finalGraph);\n        }\n      }\n      setCreatingEdge(null);\n      setMode(\"idle\");\n    }\n    setMode(\"idle\");\n  };\n\n  // --- Entity Event Wrappers ---\n  const handleEntityMouseDown = (e, id, type) => {\n    e.stopPropagation();\n\n    // Clear edge selection when clicking a node\n    setSelectedEdgeId(null);\n    if (e.button === 2) {\n      // Right Click logic (keep existing)\n      e.preventDefault();\n      e.stopPropagation();\n      const mousePos = view.getMousePos(e);\n      setMode(\"edge-create\");\n      setCreatingEdge({\n        sourceNodeId: id,\n        position: mousePos\n      });\n      // Call createPortAndStartDrag if defined...\n      return;\n    }\n    selection.handleEntityClick(e, id, type);\n    if (e.button === 0) {\n      setMode(\"drag\");\n      setDragStartMouse(view.getMousePos(e));\n      const activeNodes = new Set(selection.selectedNodes);\n      const activeContainers = new Set(selection.selectedContainerIds);\n      if (type === \"node\") activeNodes.add(id);else activeContainers.add(id);\n      setDragStartPositions(GraphLogic.collectDragStartPositions([...activeNodes, ...activeContainers], new Map(), graph));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: containerRef,\n    className: \"graph-canvas\",\n    style: {\n      position: \"relative\",\n      width: \"100%\",\n      height: \"100%\",\n      overflow: \"hidden\",\n      userSelect: \"none\",\n      cursor: view.isPanning ? \"grabbing\" : \"default\"\n    },\n    onWheel: view.handleWheel,\n    onMouseDown: handleMouseDown,\n    onMouseMove: handleMouseMove,\n    onMouseUp: handleMouseUp,\n    onContextMenu: e => e.preventDefault()\n    // Allow keyboard events to be caught by window, or add tabIndex={0} here to catch on div\n    ,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        transform: `translate(${view.view.x}px, ${view.view.y}px) scale(${view.view.zoom})`,\n        transformOrigin: \"0 0\",\n        width: \"100%\",\n        height: \"100%\",\n        position: \"absolute\",\n        top: 0,\n        left: 0\n      },\n      children: [Object.values(graph.containersById).map(c => GraphLogic.isEntityVisible(graph, c.id) && /*#__PURE__*/_jsxDEV(GraphContainer, {\n        container: c,\n        selected: selection.selectedContainerIds.has(c.id),\n        onMouseDown: e => handleEntityMouseDown(e, c.id, \"container\"),\n        onResizeMouseDown: e => {\n          e.stopPropagation();\n          setMode(\"resize\");\n          setResizingState({\n            id: c.id,\n            startMouse: view.getMousePos(e),\n            startSize: {\n              ...c.size\n            }\n          });\n        }\n        // Keep your onDoubleClick logic here\n      }, c.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 12\n      }, this)), Object.values(graph.nodesById).map(n => GraphLogic.isEntityVisible(graph, n.id) && /*#__PURE__*/_jsxDEV(GraphNode, {\n        node: n,\n        selected: selection.selectedNodes.has(n.id),\n        onMouseDown: e => handleEntityMouseDown(e, n.id, \"node\")\n      }, n.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 12\n      }, this)), /*#__PURE__*/_jsxDEV(GraphEdgeLayer, {\n        graph: graph,\n        mode: mode,\n        creatingEdge: creatingEdge,\n        selectedEdgeId: selectedEdgeId,\n        onEdgeClick: (e, edgeId) => {\n          // Select the edge\n          setSelectedEdgeId(edgeId);\n          // Deselect nodes/containers\n          selection.clearSelection();\n\n          // Optional: Detect Double Click for Editing\n          if (e.detail === 2) {\n            setEditingEntityId(edgeId);\n            setEditorPosition(view.getMousePos(e));\n          }\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(GraphPortLayer, {\n        graph: graph,\n        enablePorts: enablePorts,\n        hoveredPort: hoveredPort,\n        onHoverPort: setHoveredPort,\n        onPortMouseDown: (e, nodeId, portId, label, pos) => {\n          e.stopPropagation();\n          setCreatingEdge({\n            sourceNodeId: nodeId,\n            sourcePortId: portId,\n            position: pos\n          });\n          setMode(\"edge-create\");\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 7\n    }, this), mode === \"lasso\" && selection.lassoStart && selection.lassoEnd && /*#__PURE__*/_jsxDEV(Lasso, {\n      start: selection.lassoStart,\n      end: selection.lassoEnd\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 9\n    }, this), editingEntityId && editorPosition && /*#__PURE__*/_jsxDEV(EntityEditor, {\n      entityId: editingEntityId,\n      graph: graph,\n      position: editorPosition,\n      onClose: () => setEditingEntityId(null),\n      onGraphChange: onGraphChange,\n      enablePorts: enablePorts\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 9\n    }, this), canvasMenu && /*#__PURE__*/_jsxDEV(GraphContextMenu, {\n      canvasMenu: {\n        ...canvasMenu,\n        targetId: undefined\n      },\n      graph: graph,\n      onGraphChange: onGraphChange,\n      onClose: () => setCanvasMenu(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 254,\n    columnNumber: 5\n  }, this);\n};\n_s(GraphCanvas, \"9CXVFT4Zfy9PHd1xS8iOOf5NPk8=\", false, function () {\n  return [useGraphView, useGraphSelection, useGraphClipboard];\n});\n_c = GraphCanvas;\nvar _c;\n$RefreshReg$(_c, \"GraphCanvas\");","map":{"version":3,"names":["React","useState","useRef","useEffect","GraphNode","GraphContainer","Lasso","EntityEditor","GraphContextMenu","GraphEdgeLayer","GraphPortLayer","useGraphView","useGraphSelection","useGraphClipboard","GraphLogic","jsxDEV","_jsxDEV","GraphCanvas","graph","onGraphChange","renderNode","renderContainer","enablePorts","_s","containerRef","view","selection","clipboard","selectedNodes","selectedContainerIds","clearSelection","setSelectedNodes","setSelectedContainerIds","mode","setMode","dragStartMouse","setDragStartMouse","dragStartPositions","setDragStartPositions","Map","creatingEdge","setCreatingEdge","hoveredPort","setHoveredPort","selectedEdgeId","setSelectedEdgeId","resizingState","setResizingState","editingEntityId","setEditingEntityId","editorPosition","setEditorPosition","canvasMenu","setCanvasMenu","handleKeyDown","e","target","HTMLInputElement","HTMLTextAreaElement","key","newGraph","clone","edgesById","window","addEventListener","removeEventListener","handleMouseDown","button","nativeEvent","getModifierState","preventDefault","startPan","screenPos","x","clientX","y","clientY","graphPos","getMousePos","position","graphPosition","pos","setLassoStart","setLassoEnd","handleMouseMove","isPanning","updatePan","mousePos","dx","dy","changed","forEach","startPos","id","node","nodesById","container","containersById","startMouse","c","size","width","Math","max","startSize","height","handleMouseUp","endPan","isClick","abs","targetId","hitTestEntity","completeLasso","_","_newGraph$nodesById$i","_newGraph$containersB","assignEntityToContainer","parent","parentId","recomputeContainerSize","targetNodeId","nodeId","sourceNodeId","finalGraph","finalSourcePortId","sourcePortId","finalTargetPortId","portId","undefined","edgeId","crypto","randomUUID","targetPortId","handleEntityMouseDown","type","stopPropagation","handleEntityClick","activeNodes","Set","activeContainers","add","collectDragStartPositions","ref","className","style","overflow","userSelect","cursor","onWheel","handleWheel","onMouseDown","onMouseMove","onMouseUp","onContextMenu","children","transform","zoom","transformOrigin","top","left","Object","values","map","isEntityVisible","selected","has","onResizeMouseDown","fileName","_jsxFileName","lineNumber","columnNumber","n","onEdgeClick","detail","onHoverPort","onPortMouseDown","label","lassoStart","lassoEnd","start","end","entityId","onClose","_c","$RefreshReg$"],"sources":["/home/belac/sysFlow/src/components/GraphCanvas.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\"; // Added useEffect\nimport { GraphModel } from \"../models/GraphModel\";\nimport { Node } from \"../models/Node\";\nimport { Container } from \"../models/Container\";\nimport { Entity, ID, Vec2, Port } from \"../models/Entity\";\nimport { GraphNode } from \"./GraphNode\";\nimport { GraphContainer } from \"./GraphContainer\";\nimport { GraphEdge } from \"./GraphEdge\";\nimport { Lasso } from \"./Lasso\";\nimport { ContextMenu } from \"./ContextMenu\";\nimport { EntityEditor } from \"./EntityEditor\";\nimport { getPortPosition } from \"../utils/Geometry\";\nimport { GraphContextMenu } from \"./GraphContextMenu\";\nimport { GraphEdgeLayer } from \"./GraphEdgeLayer\";\nimport { GraphPortLayer } from \"./GraphPortLayer\";\n\n// --- HOOKS ---\nimport { useGraphView } from \"../hooks/useGraphView\";\nimport { useGraphSelection } from \"../hooks/useGraphSelection\";\nimport { useGraphClipboard } from \"../hooks/useGraphClipboard\";\n\n// --- IMPORT THE LOGIC ---\nimport * as GraphLogic from \"../utils/GraphLogic\";\n\ntype InteractionMode = \"idle\" | \"drag\" | \"lasso\" | \"edge-create\" | \"resize\";\n\ninterface GraphCanvasProps {\n  graph: GraphModel;\n  onGraphChange: (newGraph: GraphModel) => void;\n  renderNode?: (node: Node, selected: boolean) => React.ReactNode;\n  renderContainer?: (container: Container, collapsed: boolean) => React.ReactNode;\n  enablePorts: boolean;\n}\n\nexport const GraphCanvas = ({ graph, onGraphChange, renderNode, renderContainer, enablePorts }: GraphCanvasProps) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // 1. Hooks\n  const view = useGraphView(containerRef);\n  const selection = useGraphSelection(graph);\n  const clipboard = useGraphClipboard({\n    graph,\n    onGraphChange,\n    selectedNodes: selection.selectedNodes,\n    selectedContainerIds: selection.selectedContainerIds,\n    clearSelection: selection.clearSelection,\n    setSelectedNodes: selection.setSelectedNodes,\n    setSelectedContainerIds: selection.setSelectedContainerIds\n  });\n\n  // 2. Local Interaction State\n  const [mode, setMode] = useState<InteractionMode>(\"idle\");\n  const [dragStartMouse, setDragStartMouse] = useState<Vec2 | null>(null);\n  const [dragStartPositions, setDragStartPositions] = useState<Map<ID, Vec2>>(new Map());\n\n  // Creating Edges\n  const [creatingEdge, setCreatingEdge] = useState<{ sourceNodeId: ID; sourcePortId?: ID; position: Vec2 } | null>(null);\n  const [hoveredPort, setHoveredPort] = useState<{ nodeId: ID, portId: ID } | null>(null);\n\n  // NEW: Selected Edge State\n  const [selectedEdgeId, setSelectedEdgeId] = useState<string | null>(null);\n\n  // Resize\n  const [resizingState, setResizingState] = useState<{ id: ID; startMouse: Vec2; startSize: any } | null>(null);\n\n  // Menus\n  const [editingEntityId, setEditingEntityId] = useState<string | null>(null);\n  const [editorPosition, setEditorPosition] = useState<{ x: number, y: number } | null>(null);\n  const [canvasMenu, setCanvasMenu] = useState<{\n    position: { x: number, y: number },\n    graphPosition: { x: number, y: number }\n  } | null>(null);\n\n  // --- NEW: Keyboard Handler for Deletion ---\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Ignore if user is typing in an input/textarea\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) return;\n\n      if (e.key === \"Delete\" || e.key === \"Backspace\") {\n        if (selectedEdgeId) {\n          const newGraph = graph.clone();\n          delete newGraph.edgesById[selectedEdgeId];\n          onGraphChange(newGraph);\n          setSelectedEdgeId(null);\n        }\n        // You can also add node deletion here if not already handled in useGraphSelection\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [selectedEdgeId, graph, onGraphChange]);\n\n  // --- Handlers ---\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    // 0. Pan Start\n    if (e.button === 1 || (e.button === 0 && e.nativeEvent.getModifierState(\"Space\"))) {\n      e.preventDefault();\n      view.startPan(e);\n      return;\n    }\n\n    // 1. Context Menu\n    if (e.button === 2) {\n      const screenPos = { x: e.clientX, y: e.clientY };\n      const graphPos = view.getMousePos(e);\n      setCanvasMenu({ position: screenPos, graphPosition: graphPos });\n      return;\n    }\n\n    const pos = view.getMousePos(e);\n\n    // 2. Canvas Click (Left) -> Clear Selection & Start Lasso\n    if (e.button === 0) {\n      selection.clearSelection();\n      setSelectedEdgeId(null); // Clear edge selection\n      setEditingEntityId(null);\n      setCanvasMenu(null);\n\n      setMode(\"lasso\");\n      selection.setLassoStart(pos);\n      selection.setLassoEnd(pos);\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    if (view.isPanning) { view.updatePan(e); return; }\n    const mousePos = view.getMousePos(e);\n\n    if (mode === \"drag\" && dragStartMouse) {\n      const dx = mousePos.x - dragStartMouse.x;\n      const dy = mousePos.y - dragStartMouse.y;\n      const newGraph = graph.clone();\n      let changed = false;\n\n      dragStartPositions.forEach((startPos, id) => {\n        const node = newGraph.nodesById[id];\n        const container = newGraph.containersById[id];\n        if (node) { node.position = { x: startPos.x + dx, y: startPos.y + dy }; changed = true; }\n        if (container) { container.position = { x: startPos.x + dx, y: startPos.y + dy }; changed = true; }\n      });\n\n      if (changed) onGraphChange(newGraph);\n    }\n\n    if (mode === \"lasso\") { selection.setLassoEnd(mousePos); }\n    if (mode === \"edge-create\" && creatingEdge) { setCreatingEdge({ ...creatingEdge, position: mousePos }); }\n    \n    if (mode === \"resize\" && resizingState) {\n       const dx = mousePos.x - resizingState.startMouse.x;\n       const dy = mousePos.y - resizingState.startMouse.y;\n       const newGraph = graph.clone();\n       const c = newGraph.containersById[resizingState.id];\n       if (c) {\n         c.size = { width: Math.max(100, resizingState.startSize.width + dx), height: Math.max(50, resizingState.startSize.height + dy) };\n         onGraphChange(newGraph);\n       }\n    }\n  };\n\n  const handleMouseUp = (e: React.MouseEvent) => {\n    if (view.isPanning) { view.endPan(); return; }\n    \n    const pos = view.getMousePos(e);\n    const isClick = dragStartMouse && Math.abs(pos.x - dragStartMouse.x) < 5 && Math.abs(pos.y - dragStartMouse.y) < 5;\n\n    // 1. Open Editor (Click without drag)\n    if (mode === \"idle\" || (mode === \"drag\" && isClick)) {\n       const targetId = GraphLogic.hitTestEntity(graph, pos);\n       if (targetId) {\n          setEditingEntityId(targetId);\n          setEditorPosition({ x: pos.x, y: pos.y });\n          setMode(\"idle\");\n          return;\n       }\n    }\n\n    if (mode === \"lasso\") { selection.completeLasso(); }\n\n    if (mode === \"drag\" && dragStartMouse) {\n      const newGraph = graph.clone();\n      dragStartPositions.forEach((_, id) => {\n          GraphLogic.assignEntityToContainer(newGraph, id);\n          const parent = newGraph.nodesById[id]?.parentId || newGraph.containersById[id]?.parentId;\n          if (parent) GraphLogic.recomputeContainerSize(newGraph, parent);\n      });\n      onGraphChange(newGraph);\n      setDragStartMouse(null);\n      setDragStartPositions(new Map());\n    }\n\n    if (mode === \"edge-create\" && creatingEdge) {\n        const targetNodeId = hoveredPort ? hoveredPort.nodeId : GraphLogic.hitTestEntity(graph, pos);\n        if (targetNodeId && targetNodeId !== creatingEdge.sourceNodeId) {\n            let finalGraph = graph.clone();\n            let finalSourcePortId = creatingEdge.sourcePortId;\n            let finalTargetPortId = hoveredPort ? hoveredPort.portId : undefined;\n\n            // ... (Keep existing Edge Creation Logic steps 1, 2, 3) ...\n            // Simplified for brevity in this response, keep your original logic here!\n            \n            // --- STEP 3: Create the Edge ---\n            if ((!enablePorts) || (finalSourcePortId && finalTargetPortId)) {\n                const edgeId = `e_${crypto.randomUUID()}`;\n                finalGraph.edgesById[edgeId] = {\n                    id: edgeId,\n                    sourceNodeId: creatingEdge.sourceNodeId,\n                    sourcePortId: finalSourcePortId,\n                    targetNodeId: targetNodeId,\n                    targetPortId: finalTargetPortId\n                };\n                onGraphChange(finalGraph);\n            }\n        }\n        setCreatingEdge(null);\n        setMode(\"idle\");\n    }\n    setMode(\"idle\");\n  };\n\n  // --- Entity Event Wrappers ---\n  const handleEntityMouseDown = (e: React.MouseEvent, id: ID, type: \"node\" | \"container\") => {\n    e.stopPropagation();\n    \n    // Clear edge selection when clicking a node\n    setSelectedEdgeId(null);\n\n    if (e.button === 2) {\n      // Right Click logic (keep existing)\n      e.preventDefault();\n      e.stopPropagation();\n      const mousePos = view.getMousePos(e);\n      setMode(\"edge-create\");\n      setCreatingEdge({ sourceNodeId: id, position: mousePos });\n      // Call createPortAndStartDrag if defined...\n      return;\n    }\n\n    selection.handleEntityClick(e, id, type);\n\n    if (e.button === 0) {\n      setMode(\"drag\");\n      setDragStartMouse(view.getMousePos(e));\n      const activeNodes = new Set(selection.selectedNodes);\n      const activeContainers = new Set(selection.selectedContainerIds);\n      if (type === \"node\") activeNodes.add(id); else activeContainers.add(id);\n      setDragStartPositions(GraphLogic.collectDragStartPositions([...activeNodes, ...activeContainers], new Map(), graph));\n    }\n  };\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"graph-canvas\"\n      style={{\n        position: \"relative\", width: \"100%\", height: \"100%\", overflow: \"hidden\",\n        userSelect: \"none\", cursor: view.isPanning ? \"grabbing\" : \"default\"\n      }}\n      onWheel={view.handleWheel}\n      onMouseDown={handleMouseDown}\n      onMouseMove={handleMouseMove}\n      onMouseUp={handleMouseUp}\n      onContextMenu={(e) => e.preventDefault()}\n      // Allow keyboard events to be caught by window, or add tabIndex={0} here to catch on div\n    >\n      <div style={{\n          transform: `translate(${view.view.x}px, ${view.view.y}px) scale(${view.view.zoom})`,\n          transformOrigin: \"0 0\", width: \"100%\", height: \"100%\", position: \"absolute\", top: 0, left: 0\n      }}>\n\n        {/* Containers */}\n        {Object.values(graph.containersById).map(c => GraphLogic.isEntityVisible(graph, c.id) && (\n           <GraphContainer\n             key={c.id} container={c}\n             selected={selection.selectedContainerIds.has(c.id)}\n             onMouseDown={(e) => handleEntityMouseDown(e, c.id, \"container\")}\n             onResizeMouseDown={(e) => {\n                e.stopPropagation(); setMode(\"resize\");\n                setResizingState({ id: c.id, startMouse: view.getMousePos(e), startSize: {...c.size} });\n             }}\n             // Keep your onDoubleClick logic here\n           />\n        ))}\n\n        {/* Nodes */}\n        {Object.values(graph.nodesById).map(n => GraphLogic.isEntityVisible(graph, n.id) && (\n           <GraphNode\n             key={n.id} node={n}\n             selected={selection.selectedNodes.has(n.id)}\n             onMouseDown={(e) => handleEntityMouseDown(e, n.id, \"node\")}\n           />\n        ))}\n\n        {/* Edges - UPDATED */}\n        <GraphEdgeLayer \n          graph={graph} \n          mode={mode} \n          creatingEdge={creatingEdge}\n          selectedEdgeId={selectedEdgeId}\n          onEdgeClick={(e, edgeId) => {\n            // Select the edge\n            setSelectedEdgeId(edgeId);\n            // Deselect nodes/containers\n            selection.clearSelection();\n            \n            // Optional: Detect Double Click for Editing\n            if (e.detail === 2) {\n               setEditingEntityId(edgeId);\n               setEditorPosition(view.getMousePos(e));\n            }\n          }}\n        />\n\n        {/* Ports */}\n        <GraphPortLayer\n           graph={graph}\n           enablePorts={enablePorts}\n           hoveredPort={hoveredPort}\n           onHoverPort={setHoveredPort}\n           onPortMouseDown={(e, nodeId, portId, label, pos) => {\n              e.stopPropagation();\n              setCreatingEdge({ sourceNodeId: nodeId, sourcePortId: portId, position: pos });\n              setMode(\"edge-create\");\n           }}\n        />\n\n      </div>\n\n      {/* Lasso */}\n      {mode === \"lasso\" && selection.lassoStart && selection.lassoEnd && (\n        <Lasso start={selection.lassoStart} end={selection.lassoEnd} />\n      )}\n\n      {/* Popups */}\n      {editingEntityId && editorPosition && (\n        <EntityEditor\n          entityId={editingEntityId}\n          graph={graph}\n          position={editorPosition}\n          onClose={() => setEditingEntityId(null)}\n          onGraphChange={onGraphChange}\n          enablePorts={enablePorts}\n        />\n      )}\n\n      {/* CanvasMenu */}\n      {canvasMenu && (\n        <GraphContextMenu\n           canvasMenu={{...canvasMenu, targetId: undefined}}\n           graph={graph} onGraphChange={onGraphChange}\n           onClose={() => setCanvasMenu(null)}\n        />\n      )}\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}