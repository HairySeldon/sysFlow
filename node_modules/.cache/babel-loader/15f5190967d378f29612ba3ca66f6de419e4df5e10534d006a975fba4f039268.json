{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from \"react\";\nimport { GraphLogic } from \"../utils/GraphLogic\"; // Adjust path\n\nexport const useGraphSelection = graph => {\n  _s();\n  const [selectedNodes, setSelectedNodes] = useState(new Set());\n  const [selectedContainerIds, setSelectedContainerIds] = useState(new Set());\n\n  // Lasso State\n  const [lassoStart, setLassoStart] = useState(null);\n  const [lassoEnd, setLassoEnd] = useState(null);\n  const clearSelection = () => {\n    setSelectedNodes(new Set());\n    setSelectedContainerIds(new Set());\n  };\n  const selectAll = () => {\n    setSelectedNodes(new Set(Object.keys(graph.nodesById)));\n    setSelectedContainerIds(new Set(Object.keys(graph.containersById)));\n  };\n\n  // Handle clicking a Node or Container\n  const handleEntityClick = (e, entityId, type) => {\n    const isNode = type === \"node\";\n    const currentSet = isNode ? selectedNodes : selectedContainerIds;\n    const setSelected = isNode ? setSelectedNodes : setSelectedContainerIds;\n    const setOther = isNode ? setSelectedContainerIds : setSelectedNodes;\n    if (e.shiftKey) {\n      // Toggle\n      const newSet = new Set(currentSet);\n      if (newSet.has(entityId)) newSet.delete(entityId);else newSet.add(entityId);\n      setSelected(newSet);\n    } else {\n      // Replace (unless already selected, to allow dragging group)\n      if (!currentSet.has(entityId)) {\n        setOther(new Set());\n        setSelected(new Set([entityId]));\n      }\n    }\n  };\n\n  // Logic to calculate what is inside the Lasso box\n  const completeLasso = () => {\n    if (!lassoStart || !lassoEnd) return;\n    const x1 = Math.min(lassoStart.x, lassoEnd.x);\n    const x2 = Math.max(lassoStart.x, lassoEnd.x);\n    const y1 = Math.min(lassoStart.y, lassoEnd.y);\n    const y2 = Math.max(lassoStart.y, lassoEnd.y);\n\n    // Ignore tiny accidental drags\n    if (Math.abs(x2 - x1) < 5 && Math.abs(y2 - y1) < 5) {\n      setLassoStart(null);\n      setLassoEnd(null);\n      return;\n    }\n    const newSelectedNodes = new Set();\n    const newSelectedContainers = new Set();\n    Object.values(graph.nodesById).forEach(node => {\n      if (GraphLogic.isEntityVisible(graph, node.id) && node.position.x >= x1 && node.position.x + 100 <= x2 && node.position.y >= y1 && node.position.y + 50 <= y2) {\n        newSelectedNodes.add(node.id);\n      }\n    });\n    Object.values(graph.containersById).forEach(c => {\n      if (GraphLogic.isEntityVisible(graph, c.id) && c.position.x >= x1 && c.position.x + c.size.width <= x2 && c.position.y >= y1 && c.position.y + c.size.height <= y2) {\n        newSelectedContainers.add(c.id);\n      }\n    });\n    setSelectedNodes(newSelectedNodes);\n    setSelectedContainerIds(newSelectedContainers);\n    setLassoStart(null);\n    setLassoEnd(null);\n  };\n  return {\n    selectedNodes,\n    selectedContainerIds,\n    setSelectedNodes,\n    setSelectedContainerIds,\n    clearSelection,\n    selectAll,\n    handleEntityClick,\n    lassoStart,\n    setLassoStart,\n    lassoEnd,\n    setLassoEnd,\n    completeLasso\n  };\n};\n_s(useGraphSelection, \"rAHnBcXh9xmDHra5FZmjGZOgqtY=\");","map":{"version":3,"names":["useState","GraphLogic","useGraphSelection","graph","_s","selectedNodes","setSelectedNodes","Set","selectedContainerIds","setSelectedContainerIds","lassoStart","setLassoStart","lassoEnd","setLassoEnd","clearSelection","selectAll","Object","keys","nodesById","containersById","handleEntityClick","e","entityId","type","isNode","currentSet","setSelected","setOther","shiftKey","newSet","has","delete","add","completeLasso","x1","Math","min","x","x2","max","y1","y","y2","abs","newSelectedNodes","newSelectedContainers","values","forEach","node","isEntityVisible","id","position","c","size","width","height"],"sources":["/home/belac/sysFlow/src/hooks/useGraphSelection.ts"],"sourcesContent":["import { useState } from \"react\";\nimport { GraphModel } from \"../models/GraphModel\";\nimport { GraphLogic } from \"../utils/GraphLogic\"; // Adjust path\nimport { ID, Vec2 } from \"../models/Entity\";\n\nexport const useGraphSelection = (graph: GraphModel) => {\n  const [selectedNodes, setSelectedNodes] = useState<Set<ID>>(new Set());\n  const [selectedContainerIds, setSelectedContainerIds] = useState<Set<ID>>(new Set());\n  \n  // Lasso State\n  const [lassoStart, setLassoStart] = useState<Vec2 | null>(null);\n  const [lassoEnd, setLassoEnd] = useState<Vec2 | null>(null);\n\n  const clearSelection = () => {\n    setSelectedNodes(new Set());\n    setSelectedContainerIds(new Set());\n  };\n\n  const selectAll = () => {\n    setSelectedNodes(new Set(Object.keys(graph.nodesById)));\n    setSelectedContainerIds(new Set(Object.keys(graph.containersById)));\n  };\n\n  // Handle clicking a Node or Container\n  const handleEntityClick = (e: React.MouseEvent, entityId: ID, type: \"node\" | \"container\") => {\n    const isNode = type === \"node\";\n    const currentSet = isNode ? selectedNodes : selectedContainerIds;\n    const setSelected = isNode ? setSelectedNodes : setSelectedContainerIds;\n    const setOther = isNode ? setSelectedContainerIds : setSelectedNodes;\n\n    if (e.shiftKey) {\n      // Toggle\n      const newSet = new Set(currentSet);\n      if (newSet.has(entityId)) newSet.delete(entityId);\n      else newSet.add(entityId);\n      setSelected(newSet);\n    } else {\n      // Replace (unless already selected, to allow dragging group)\n      if (!currentSet.has(entityId)) {\n        setOther(new Set());\n        setSelected(new Set([entityId]));\n      }\n    }\n  };\n\n  // Logic to calculate what is inside the Lasso box\n  const completeLasso = () => {\n    if (!lassoStart || !lassoEnd) return;\n    \n    const x1 = Math.min(lassoStart.x, lassoEnd.x);\n    const x2 = Math.max(lassoStart.x, lassoEnd.x);\n    const y1 = Math.min(lassoStart.y, lassoEnd.y);\n    const y2 = Math.max(lassoStart.y, lassoEnd.y);\n\n    // Ignore tiny accidental drags\n    if (Math.abs(x2 - x1) < 5 && Math.abs(y2 - y1) < 5) {\n        setLassoStart(null);\n        setLassoEnd(null);\n        return;\n    }\n\n    const newSelectedNodes = new Set<string>();\n    const newSelectedContainers = new Set<string>();\n\n    Object.values(graph.nodesById).forEach(node => {\n      if (GraphLogic.isEntityVisible(graph, node.id) &&\n          node.position.x >= x1 && node.position.x + 100 <= x2 &&\n          node.position.y >= y1 && node.position.y + 50 <= y2) {\n        newSelectedNodes.add(node.id);\n      }\n    });\n\n    Object.values(graph.containersById).forEach(c => {\n      if (GraphLogic.isEntityVisible(graph, c.id) &&\n          c.position.x >= x1 && c.position.x + c.size.width <= x2 &&\n          c.position.y >= y1 && c.position.y + c.size.height <= y2) {\n        newSelectedContainers.add(c.id);\n      }\n    });\n\n    setSelectedNodes(newSelectedNodes);\n    setSelectedContainerIds(newSelectedContainers);\n    setLassoStart(null);\n    setLassoEnd(null);\n  };\n\n  return {\n    selectedNodes,\n    selectedContainerIds,\n    setSelectedNodes,\n    setSelectedContainerIds,\n    clearSelection,\n    selectAll,\n    handleEntityClick,\n    lassoStart, setLassoStart,\n    lassoEnd, setLassoEnd,\n    completeLasso\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}