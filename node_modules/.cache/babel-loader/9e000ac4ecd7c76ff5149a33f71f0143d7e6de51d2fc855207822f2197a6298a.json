{"ast":null,"code":"var _jsxFileName = \"/home/belac/sysFlow/src/components/GraphContextMenu.tsx\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { ContextMenu } from \"./ContextMenu\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const GraphContextMenu = ({\n  canvasMenu,\n  graph,\n  onGraphChange,\n  onClose\n}) => {\n  if (!canvasMenu) return null;\n\n  // Fallback to position if graphPosition is missing\n  const insertionPos = canvasMenu.graphPosition || canvasMenu.position;\n  const getOptions = () => {\n    // 1. CANVAS (Background)\n    if (!canvasMenu.targetId) {\n      return [{\n        label: \"Add Node\",\n        onClick: () => {\n          const newGraph = graph.clone();\n          const id = `n_${crypto.randomUUID().slice(0, 4)}`;\n          newGraph.addNode({\n            id,\n            label: \"New Node\",\n            position: insertionPos,\n            // <--- USE INSERTION POS\n            ports: [],\n            size: {\n              width: 100,\n              height: 50\n            }\n          });\n          onGraphChange(newGraph);\n          onClose();\n        }\n      }, {\n        label: \"Add Container\",\n        onClick: () => {\n          const newGraph = graph.clone();\n          const id = `c_${crypto.randomUUID().slice(0, 4)}`;\n          newGraph.addContainer({\n            id,\n            label: \"New Container\",\n            position: insertionPos,\n            // <--- USE INSERTION POS\n            size: {\n              width: 300,\n              height: 200\n            },\n            nodeIds: [],\n            childContainerIds: [],\n            collapsed: false\n          });\n          onGraphChange(newGraph);\n          onClose();\n        }\n      }];\n    }\n    return [];\n  };\n  const menuUI = /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"fixed\",\n        top: 0,\n        left: 0,\n        width: \"100vw\",\n        height: \"100vh\",\n        zIndex: 9998\n      },\n      onMouseDown: e => {\n        e.stopPropagation();\n        onClose();\n      },\n      onContextMenu: e => {\n        e.preventDefault();\n        e.stopPropagation();\n        onClose();\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"fixed\",\n        // Must be fixed to ignore parent scaling\n        top: canvasMenu.position.y,\n        left: canvasMenu.position.x,\n        zIndex: 9999\n      },\n      children: /*#__PURE__*/_jsxDEV(ContextMenu, {\n        position: canvasMenu.position,\n        options: getOptions()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n\n  // 4. THE MAGIC: Render directly into document.body\n  return /*#__PURE__*/ReactDOM.createPortal(menuUI, document.body);\n};\n_c = GraphContextMenu;\nvar _c;\n$RefreshReg$(_c, \"GraphContextMenu\");","map":{"version":3,"names":["React","ReactDOM","ContextMenu","jsxDEV","_jsxDEV","Fragment","_Fragment","GraphContextMenu","canvasMenu","graph","onGraphChange","onClose","insertionPos","graphPosition","position","getOptions","targetId","label","onClick","newGraph","clone","id","crypto","randomUUID","slice","addNode","ports","size","width","height","addContainer","nodeIds","childContainerIds","collapsed","menuUI","children","style","top","left","zIndex","onMouseDown","e","stopPropagation","onContextMenu","preventDefault","fileName","_jsxFileName","lineNumber","columnNumber","y","x","options","createPortal","document","body","_c","$RefreshReg$"],"sources":["/home/belac/sysFlow/src/components/GraphContextMenu.tsx"],"sourcesContent":["import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { ContextMenu } from \"./ContextMenu\";\n\nexport interface CanvasMenuState {\n  targetId?: string | null;\n  position: { x: number; y: number };      // Screen Coords\n  graphPosition?: { x: number; y: number }; // Graph Coords (Optional for backward compat)\n}\n\ninterface GraphContextMenuProps {\n  canvasMenu: CanvasMenuState | null;\n  graph: any;\n  onGraphChange: (newGraph: any) => void;\n  onClose: () => void;\n}\n\nexport const GraphContextMenu: React.FC<GraphContextMenuProps> = ({\n  canvasMenu,\n  graph,\n  onGraphChange,\n  onClose,\n}) => {\n  if (!canvasMenu) return null;\n\n  // Fallback to position if graphPosition is missing\n  const insertionPos = canvasMenu.graphPosition || canvasMenu.position;\n\n  const getOptions = () => {\n    // 1. CANVAS (Background)\n    if (!canvasMenu.targetId) {\n      return [\n        {\n          label: \"Add Node\",\n          onClick: () => {\n            const newGraph = graph.clone();\n            const id = `n_${crypto.randomUUID().slice(0, 4)}`;\n            newGraph.addNode({\n              id,\n              label: \"New Node\",\n              position: insertionPos, // <--- USE INSERTION POS\n              ports: [],\n              size: { width: 100, height: 50 },\n            });\n            onGraphChange(newGraph);\n            onClose();\n          },\n        },\n        {\n          label: \"Add Container\",\n          onClick: () => {\n            const newGraph = graph.clone();\n            const id = `c_${crypto.randomUUID().slice(0, 4)}`;\n            newGraph.addContainer({\n              id,\n              label: \"New Container\",\n              position: insertionPos, // <--- USE INSERTION POS\n              size: { width: 300, height: 200 },\n              nodeIds: [],\n              childContainerIds: [],\n              collapsed: false,\n            });\n            onGraphChange(newGraph);\n            onClose();\n          },\n        },\n      ];\n    }\n    return [];\n  };\n\n  const menuUI = (\n    <>\n      {/* 2. The Full Screen Invisible Shield (Click to close) */}\n      <div\n        style={{\n          position: \"fixed\",\n          top: 0,\n          left: 0,\n          width: \"100vw\",\n          height: \"100vh\",\n          zIndex: 9998,\n        }}\n        onMouseDown={(e) => {\n          e.stopPropagation();\n          onClose();\n        }}\n        onContextMenu={(e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          onClose();\n        }}\n      />\n\n      {/* 3. The Menu Itself - Uses FIXED position */}\n      <div\n        style={{\n          position: \"fixed\", // Must be fixed to ignore parent scaling\n          top: canvasMenu.position.y,\n          left: canvasMenu.position.x,\n          zIndex: 9999,\n        }}\n      >\n        <ContextMenu position={canvasMenu.position} options={getOptions()} />\n      </div>\n    </>\n  );\n\n  // 4. THE MAGIC: Render directly into document.body\n  return ReactDOM.createPortal(menuUI, document.body);\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}