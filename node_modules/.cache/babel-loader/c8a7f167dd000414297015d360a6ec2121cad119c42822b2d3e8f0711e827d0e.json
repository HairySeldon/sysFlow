{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from \"react\";\nimport * as GraphLogic from \"../utils/GraphLogic\"; // Adjust path\n\nexport const useGraphSelection = graph => {\n  _s();\n  const [selectedNodes, setSelectedNodes] = useState(new Set());\n  const [selectedContainerIds, setSelectedContainerIds] = useState(new Set());\n\n  // Lasso State\n  const [lassoStart, setLassoStart] = useState(null);\n  const [lassoEnd, setLassoEnd] = useState(null);\n  const clearSelection = () => {\n    setSelectedNodes(new Set());\n    setSelectedContainerIds(new Set());\n  };\n  const selectAll = () => {\n    setSelectedNodes(new Set(Object.keys(graph.nodesById)));\n    setSelectedContainerIds(new Set(Object.keys(graph.containersById)));\n  };\n\n  // Handle clicking a Node or Container\n  const handleEntityClick = (e, entityId, type) => {\n    const isNode = type === \"node\";\n    const currentSet = isNode ? selectedNodes : selectedContainerIds;\n    const setSelected = isNode ? setSelectedNodes : setSelectedContainerIds;\n    const setOther = isNode ? setSelectedContainerIds : setSelectedNodes;\n    if (e.shiftKey) {\n      // Toggle\n      const newSet = new Set(currentSet);\n      if (newSet.has(entityId)) newSet.delete(entityId);else newSet.add(entityId);\n      setSelected(newSet);\n    } else {\n      // Replace (unless already selected, to allow dragging group)\n      if (!currentSet.has(entityId)) {\n        setOther(new Set());\n        setSelected(new Set([entityId]));\n      }\n    }\n  };\n\n  // Logic to calculate what is inside the Lasso box\n  // Logic to calculate what is inside the Lasso box\n  const completeLasso = useCallback(() => {\n    if (!lassoStart || !lassoEnd) return;\n\n    // 1. Calculate the Lasso Box in SCREEN Coordinates (Pixels)\n    const screenX1 = Math.min(lassoStart.x, lassoEnd.x);\n    const screenX2 = Math.max(lassoStart.x, lassoEnd.x);\n    const screenY1 = Math.min(lassoStart.y, lassoEnd.y);\n    const screenY2 = Math.max(lassoStart.y, lassoEnd.y);\n\n    // Ignore tiny accidental drags\n    if (Math.abs(screenX2 - screenX1) < 5 && Math.abs(screenY2 - screenY1) < 5) {\n      setLassoStart(null);\n      setLassoEnd(null);\n      return;\n    }\n\n    // 2. CONVERT to WORLD Coordinates (The Graph's Reality)\n    // Formula: (Screen - Pan) / Zoom\n    const worldX1 = (screenX1 - view.x) / view.zoom;\n    const worldX2 = (screenX2 - view.x) / view.zoom;\n    const worldY1 = (screenY1 - view.y) / view.zoom;\n    const worldY2 = (screenY2 - view.y) / view.zoom;\n    const newSelectedNodes = new Set();\n    const newSelectedContainers = new Set();\n\n    // 3. Check collisions against the WORLD Box\n    Object.values(graph.nodesById).forEach(node => {\n      if (GraphLogic.isEntityVisible(graph, node.id) && node.position.x >= worldX1 && node.position.x + 100 <= worldX2 &&\n      // Assuming fixed width 100\n      node.position.y >= worldY1 && node.position.y + 50 <= worldY2) {\n        // Assuming fixed height 50\n\n        newSelectedNodes.add(node.id);\n      }\n    });\n    Object.values(graph.containersById).forEach(c => {\n      if (GraphLogic.isEntityVisible(graph, c.id) && c.position.x >= worldX1 && c.position.x + c.size.width <= worldX2 && c.position.y >= worldY1 && c.position.y + c.size.height <= worldY2) {\n        newSelectedContainers.add(c.id);\n      }\n    });\n    setSelectedNodes(newSelectedNodes);\n    setSelectedContainerIds(newSelectedContainers);\n    setLassoStart(null);\n    setLassoEnd(null);\n  }, [lassoStart, lassoEnd, view, graph]);\n  return {\n    selectedNodes,\n    selectedContainerIds,\n    setSelectedNodes,\n    setSelectedContainerIds,\n    clearSelection,\n    selectAll,\n    handleEntityClick,\n    lassoStart,\n    setLassoStart,\n    lassoEnd,\n    setLassoEnd,\n    completeLasso\n  };\n};\n_s(useGraphSelection, \"9/H/e0Tx5O9UXqPriEIwMlatOCE=\");","map":{"version":3,"names":["useState","GraphLogic","useGraphSelection","graph","_s","selectedNodes","setSelectedNodes","Set","selectedContainerIds","setSelectedContainerIds","lassoStart","setLassoStart","lassoEnd","setLassoEnd","clearSelection","selectAll","Object","keys","nodesById","containersById","handleEntityClick","e","entityId","type","isNode","currentSet","setSelected","setOther","shiftKey","newSet","has","delete","add","completeLasso","useCallback","screenX1","Math","min","x","screenX2","max","screenY1","y","screenY2","abs","worldX1","view","zoom","worldX2","worldY1","worldY2","newSelectedNodes","newSelectedContainers","values","forEach","node","isEntityVisible","id","position","c","size","width","height"],"sources":["/home/belac/sysFlow/src/hooks/useGraphSelection.ts"],"sourcesContent":["import { useState } from \"react\";\nimport { GraphModel } from \"../models/GraphModel\";\nimport * as GraphLogic from \"../utils/GraphLogic\"; // Adjust path\nimport { ID, Vec2 } from \"../models/Entity\";\n\nexport const useGraphSelection = (graph: GraphModel) => {\n  const [selectedNodes, setSelectedNodes] = useState<Set<ID>>(new Set());\n  const [selectedContainerIds, setSelectedContainerIds] = useState<Set<ID>>(new Set());\n  \n  // Lasso State\n  const [lassoStart, setLassoStart] = useState<Vec2 | null>(null);\n  const [lassoEnd, setLassoEnd] = useState<Vec2 | null>(null);\n\n  const clearSelection = () => {\n    setSelectedNodes(new Set());\n    setSelectedContainerIds(new Set());\n  };\n\n  const selectAll = () => {\n    setSelectedNodes(new Set(Object.keys(graph.nodesById)));\n    setSelectedContainerIds(new Set(Object.keys(graph.containersById)));\n  };\n\n  // Handle clicking a Node or Container\n  const handleEntityClick = (e: React.MouseEvent, entityId: ID, type: \"node\" | \"container\") => {\n    const isNode = type === \"node\";\n    const currentSet = isNode ? selectedNodes : selectedContainerIds;\n    const setSelected = isNode ? setSelectedNodes : setSelectedContainerIds;\n    const setOther = isNode ? setSelectedContainerIds : setSelectedNodes;\n\n    if (e.shiftKey) {\n      // Toggle\n      const newSet = new Set(currentSet);\n      if (newSet.has(entityId)) newSet.delete(entityId);\n      else newSet.add(entityId);\n      setSelected(newSet);\n    } else {\n      // Replace (unless already selected, to allow dragging group)\n      if (!currentSet.has(entityId)) {\n        setOther(new Set());\n        setSelected(new Set([entityId]));\n      }\n    }\n  };\n\n  // Logic to calculate what is inside the Lasso box\n// Logic to calculate what is inside the Lasso box\nconst completeLasso = useCallback(() => {\n  if (!lassoStart || !lassoEnd) return;\n\n  // 1. Calculate the Lasso Box in SCREEN Coordinates (Pixels)\n  const screenX1 = Math.min(lassoStart.x, lassoEnd.x);\n  const screenX2 = Math.max(lassoStart.x, lassoEnd.x);\n  const screenY1 = Math.min(lassoStart.y, lassoEnd.y);\n  const screenY2 = Math.max(lassoStart.y, lassoEnd.y);\n\n  // Ignore tiny accidental drags\n  if (Math.abs(screenX2 - screenX1) < 5 && Math.abs(screenY2 - screenY1) < 5) {\n      setLassoStart(null);\n      setLassoEnd(null);\n      return;\n  }\n\n  // 2. CONVERT to WORLD Coordinates (The Graph's Reality)\n  // Formula: (Screen - Pan) / Zoom\n  const worldX1 = (screenX1 - view.x) / view.zoom;\n  const worldX2 = (screenX2 - view.x) / view.zoom;\n  const worldY1 = (screenY1 - view.y) / view.zoom;\n  const worldY2 = (screenY2 - view.y) / view.zoom;\n\n  const newSelectedNodes = new Set<string>();\n  const newSelectedContainers = new Set<string>();\n\n  // 3. Check collisions against the WORLD Box\n  Object.values(graph.nodesById).forEach(node => {\n    if (GraphLogic.isEntityVisible(graph, node.id) &&\n        node.position.x >= worldX1 && \n        node.position.x + 100 <= worldX2 && // Assuming fixed width 100\n        node.position.y >= worldY1 && \n        node.position.y + 50 <= worldY2) {  // Assuming fixed height 50\n        \n        newSelectedNodes.add(node.id);\n    }\n  });\n\n  Object.values(graph.containersById).forEach(c => {\n    if (GraphLogic.isEntityVisible(graph, c.id) &&\n        c.position.x >= worldX1 && \n        c.position.x + c.size.width <= worldX2 &&\n        c.position.y >= worldY1 && \n        c.position.y + c.size.height <= worldY2) {\n        \n        newSelectedContainers.add(c.id);\n    }\n  });\n\n  setSelectedNodes(newSelectedNodes);\n  setSelectedContainerIds(newSelectedContainers);\n  setLassoStart(null);\n  setLassoEnd(null);\n}, [lassoStart, lassoEnd, view, graph]);\n\n  return {\n    selectedNodes,\n    selectedContainerIds,\n    setSelectedNodes,\n    setSelectedContainerIds,\n    clearSelection,\n    selectAll,\n    handleEntityClick,\n    lassoStart, setLassoStart,\n    lassoEnd, setLassoEnd,\n    completeLasso\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}