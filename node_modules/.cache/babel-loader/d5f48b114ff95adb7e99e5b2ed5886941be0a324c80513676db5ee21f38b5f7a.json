{"ast":null,"code":"var _jsxFileName = \"/home/belac/sysFlow/src/components/GraphCanvas.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef } from \"react\";\nimport { GraphNode } from \"./GraphNode\";\nimport { GraphContainer } from \"./GraphContainer\";\nimport { EntityEditor } from \"./EntityEditor\";\nimport { getPortPosition } from \"../utils/Geometry\";\n\n// --- IMPORT THE LOGIC ---\nimport * as GraphLogic from \"../utils/GraphLogic\";\n\n// Config\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ENABLE_EXPLICIT_PORTS = true;\nexport const GraphCanvas = ({\n  graph,\n  onGraphChange,\n  renderNode,\n  renderContainer\n}) => {\n  _s();\n  const containerRef = useRef(null);\n\n  // State\n  const [selectedNodes, setSelectedNodes] = useState(new Set());\n  const [selectedContainerIds, setSelectedContainerIds] = useState(new Set());\n  const [mode, setMode] = useState(\"idle\");\n  const [dragStartMouse, setDragStartMouse] = useState(null);\n  const [dragStartPositions, setDragStartPositions] = useState(new Map());\n  const [lassoStart, setLassoStart] = useState(null);\n  const [lassoEnd, setLassoEnd] = useState(null);\n  const [creatingEdge, setCreatingEdge] = useState(null);\n  const [canvasMenu, setCanvasMenu] = useState(null);\n  const [resizingState, setResizingState] = useState(null);\n\n  // Port State\n  const [hoveredPort, setHoveredPort] = useState(null);\n  const [dragStartPortId, setDragStartPortId] = useState(null);\n  const [pendingSourcePortLabel, setPendingSourcePortLabel] = useState(null);\n\n  // Editor State\n  const [editingEntityId, setEditingEntityId] = useState(null);\n  const [editorPosition, setEditorPosition] = useState(null);\n  const getMousePos = e => {\n    const rect = containerRef.current.getBoundingClientRect();\n    return {\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top\n    };\n  };\n  const clearAllStates = () => {\n    setSelectedNodes(new Set());\n    setSelectedContainerIds(new Set());\n    setCanvasMenu(null);\n  };\n\n  // --- Rendering Helpers ---\n\n  const renderPorts = entity => {\n    // USE LOGIC: Calculate which ports to show (proxies or real)\n    const portsToRender = \"nodeIds\" in entity ? GraphLogic.getRenderablePorts(graph, entity) : entity.ports || [];\n    return portsToRender.map(port => {\n      // Geometry Calculation\n      const pos = getPortPosition(entity, port.id, graph, \"nodeIds\" in entity ? entity.size : {\n        width: 100,\n        height: 50\n      });\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        title: port.label,\n        style: {\n          position: \"absolute\",\n          left: pos.x - 6,\n          top: pos.y - 6,\n          width: 12,\n          height: 12,\n          borderRadius: \"50%\",\n          backgroundColor: \"#fff\",\n          border: \"2px solid #333\",\n          zIndex: 100,\n          cursor: \"pointer\"\n        },\n        onMouseEnter: () => setHoveredPort({\n          nodeId: entity.id,\n          portId: port.id\n        }),\n        onMouseLeave: () => setHoveredPort(null),\n        onMouseDown: e => {\n          e.stopPropagation();\n          setCreatingEdge({\n            sourceNodeId: entity.id,\n            position: pos\n          });\n          setDragStartPortId(port.id);\n          setPendingSourcePortLabel(port.label);\n          setMode(\"edge-create\");\n          setDragStartMouse(getMousePos(e));\n        }\n      }, port.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this);\n    });\n  };\n\n  // --- Event Handlers ---\n\n  const handleMouseDown = e => {\n    const pos = getMousePos(e);\n\n    // 1. Port Interaction\n    if (ENABLE_EXPLICIT_PORTS && hoveredPort) {\n      // Logic handled in renderPorts onMouseDown\n      return;\n    }\n\n    // 2. Right Click\n    if (e.button === 2 && e.target === e.currentTarget) {\n      e.preventDefault();\n      setCanvasMenu({\n        position: {\n          x: e.clientX,\n          y: e.clientY\n        }\n      });\n      return;\n    }\n\n    // 3. Canvas Click (Clear)\n    if (e.target === e.currentTarget) {\n      clearAllStates();\n      setMode(\"lasso\");\n      setLassoStart(pos);\n      setLassoEnd(pos);\n      setEditingEntityId(null);\n    }\n  };\n  const handleMouseMove = e => {\n    // ... (Existing Lasso / Drag Logic, but ensure you call GraphLogic for visibility checks if needed)\n  };\n  const handleMouseUp = e => {\n    const pos = getMousePos(e);\n    if (mode === \"edge-create\" && creatingEdge) {\n      // USE LOGIC: Hit test via the helper\n      let targetNodeId = hoveredPort ? hoveredPort.nodeId : GraphLogic.hitTestEntity(graph, pos);\n      let targetPortId = hoveredPort ? hoveredPort.portId : null;\n      if (targetNodeId && targetNodeId !== creatingEdge.sourceNodeId) {\n        // ... Perform your edge creation logic here ...\n        // (This is where you'd use graph.addEdge)\n        // Check if explicit ports are enabled, create ports if missing, etc.\n        const newGraph = graph.clone();\n\n        // Example simple edge add for brevity (Replace with your robust logic):\n        const edgeId = `e_${crypto.randomUUID()}`;\n        newGraph.addEdge({\n          id: edgeId,\n          sourceNodeId: creatingEdge.sourceNodeId,\n          // <--- Fixed\n          sourcePortId: creatingEdge.sourcePortId,\n          targetNodeId: targetNodeId,\n          // <--- Fixed\n          targetPortId: targetPortId || undefined\n        });\n        onGraphChange(newGraph);\n      }\n      setCreatingEdge(null);\n      setMode(\"idle\");\n    }\n    if (mode === \"drag\") {\n      // USE LOGIC: When dropping, check containment\n      const newGraph = graph.clone();\n\n      // Check every node/container that was dragged\n      // We only check the \"roots\" of the drag to avoid double processing\n      dragStartPositions.forEach((_, id) => {\n        var _newGraph$nodesById$i, _newGraph$containersB;\n        GraphLogic.assignEntityToContainer(newGraph, id);\n        // Also recompute sizes of parents that might have grown\n        const parent = ((_newGraph$nodesById$i = newGraph.nodesById[id]) === null || _newGraph$nodesById$i === void 0 ? void 0 : _newGraph$nodesById$i.parentId) || ((_newGraph$containersB = newGraph.containersById[id]) === null || _newGraph$containersB === void 0 ? void 0 : _newGraph$containersB.parentId);\n        if (parent) GraphLogic.recomputeContainerSize(newGraph, parent);\n      });\n      onGraphChange(newGraph);\n      setMode(\"idle\");\n      setDragStartMouse(null);\n      setDragStartPositions(new Map());\n    }\n\n    // ... Lasso cleanup ...\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: containerRef,\n    className: \"graph-canvas\",\n    style: {\n      position: \"relative\",\n      width: \"100%\",\n      height: \"100%\",\n      overflow: \"hidden\",\n      userSelect: \"none\"\n    },\n    onMouseDown: handleMouseDown,\n    onMouseMove: handleMouseMove,\n    onMouseUp: handleMouseUp,\n    onContextMenu: e => e.preventDefault(),\n    children: [Object.values(graph.containersById).map(c => {\n      if (!GraphLogic.isEntityVisible(graph, c.id)) return null;\n      return /*#__PURE__*/_jsxDEV(React.Fragment, {\n        children: /*#__PURE__*/_jsxDEV(GraphContainer, {\n          container: c,\n          selected: selectedContainerIds.has(c.id),\n          onMouseDown: e => {\n            e.stopPropagation();\n            // Select logic\n            if (!e.shiftKey) {\n              setSelectedNodes(new Set());\n              setSelectedContainerIds(new Set([c.id]));\n            } else {\n              const newSet = new Set(selectedContainerIds);\n              newSet.has(c.id) ? newSet.delete(c.id) : newSet.add(c.id);\n              setSelectedContainerIds(newSet);\n            }\n            // Start dragging\n            setMode(\"drag\");\n            setDragStartMouse(getMousePos(e));\n            setDragStartPositions(GraphLogic.collectDragStartPositions([c.id], new Map(), graph));\n          },\n          onDoubleClick: e => {\n            e.stopPropagation();\n            setEditingEntityId(c.id);\n            setEditorPosition({\n              x: e.clientX,\n              y: e.clientY\n            });\n          },\n          onContextMenu: e => {\n            e.preventDefault();\n            e.stopPropagation();\n            setCanvasMenu({\n              targetId: c.id,\n              type: \"container\",\n              position: {\n                x: e.clientX,\n                y: e.clientY\n              }\n            });\n          },\n          children: renderPorts(c)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 13\n        }, this)\n      }, c.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 9\n      }, this);\n    }), Object.values(graph.nodesById).map(n => {\n      if (!GraphLogic.isEntityVisible(graph, n.id)) return null;\n      return /*#__PURE__*/_jsxDEV(React.Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(GraphNode, {\n          node: n,\n          selected: selectedNodes.has(n.id),\n          onMouseDown: e => {\n            e.stopPropagation();\n            // Select logic\n            if (!e.shiftKey) {\n              setSelectedContainerIds(new Set());\n              setSelectedNodes(new Set([n.id]));\n            } else {\n              const newSet = new Set(selectedNodes);\n              newSet.has(n.id) ? newSet.delete(n.id) : newSet.add(n.id);\n              setSelectedNodes(newSet);\n            }\n\n            // Right click check for menu\n            if (e.button === 2) {\n              setCanvasMenu({\n                targetId: n.id,\n                type: \"node\",\n                position: {\n                  x: e.clientX,\n                  y: e.clientY\n                }\n              });\n              return;\n            }\n\n            // Start dragging\n            setMode(\"drag\");\n            setDragStartMouse(getMousePos(e));\n            setDragStartPositions(GraphLogic.collectDragStartPositions([n.id], new Map(), graph));\n          },\n          onDoubleClick: e => {\n            e.stopPropagation();\n            setEditingEntityId(n.id);\n            setEditorPosition({\n              x: e.clientX,\n              y: e.clientY\n            });\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 21\n        }, this), renderPorts(n)]\n      }, n.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 21\n      }, this);\n    }), editingEntityId && editorPosition && /*#__PURE__*/_jsxDEV(EntityEditor, {\n      entityId: editingEntityId,\n      graph: graph,\n      position: editorPosition,\n      onClose: () => setEditingEntityId(null),\n      onGraphChange: onGraphChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 14\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 190,\n    columnNumber: 5\n  }, this);\n};\n_s(GraphCanvas, \"oFgUxQV31bBGuJv8eQDz2sw1a4Y=\");\n_c = GraphCanvas;\nvar _c;\n$RefreshReg$(_c, \"GraphCanvas\");","map":{"version":3,"names":["React","useState","useRef","GraphNode","GraphContainer","EntityEditor","getPortPosition","GraphLogic","jsxDEV","_jsxDEV","ENABLE_EXPLICIT_PORTS","GraphCanvas","graph","onGraphChange","renderNode","renderContainer","_s","containerRef","selectedNodes","setSelectedNodes","Set","selectedContainerIds","setSelectedContainerIds","mode","setMode","dragStartMouse","setDragStartMouse","dragStartPositions","setDragStartPositions","Map","lassoStart","setLassoStart","lassoEnd","setLassoEnd","creatingEdge","setCreatingEdge","canvasMenu","setCanvasMenu","resizingState","setResizingState","hoveredPort","setHoveredPort","dragStartPortId","setDragStartPortId","pendingSourcePortLabel","setPendingSourcePortLabel","editingEntityId","setEditingEntityId","editorPosition","setEditorPosition","getMousePos","e","rect","current","getBoundingClientRect","x","clientX","left","y","clientY","top","clearAllStates","renderPorts","entity","portsToRender","getRenderablePorts","ports","map","port","pos","id","size","width","height","title","label","style","position","borderRadius","backgroundColor","border","zIndex","cursor","onMouseEnter","nodeId","portId","onMouseLeave","onMouseDown","stopPropagation","sourceNodeId","fileName","_jsxFileName","lineNumber","columnNumber","handleMouseDown","button","target","currentTarget","preventDefault","handleMouseMove","handleMouseUp","targetNodeId","hitTestEntity","targetPortId","newGraph","clone","edgeId","crypto","randomUUID","addEdge","sourcePortId","undefined","forEach","_","_newGraph$nodesById$i","_newGraph$containersB","assignEntityToContainer","parent","nodesById","parentId","containersById","recomputeContainerSize","ref","className","overflow","userSelect","onMouseMove","onMouseUp","onContextMenu","children","Object","values","c","isEntityVisible","Fragment","container","selected","has","shiftKey","newSet","delete","add","collectDragStartPositions","onDoubleClick","targetId","type","n","node","entityId","onClose","_c","$RefreshReg$"],"sources":["/home/belac/sysFlow/src/components/GraphCanvas.tsx"],"sourcesContent":["import React, { useState, useRef } from \"react\";\nimport { GraphModel } from \"../models/GraphModel\";\nimport { Node } from \"../models/Node\";\nimport { Container } from \"../models/Container\";\nimport { ID, Vec2, Port } from \"../models/Entity\";\nimport { GraphNode } from \"./GraphNode\";\nimport { GraphContainer } from \"./GraphContainer\";\nimport { GraphEdge } from \"./GraphEdge\";\nimport { Lasso } from \"./Lasso\";\nimport { ContextMenu } from \"./ContextMenu\";\nimport { EntityEditor } from \"./EntityEditor\";\nimport { getPortPosition } from \"../utils/Geometry\";\n\n// --- IMPORT THE LOGIC ---\nimport * as GraphLogic from \"../utils/GraphLogic\";\n\n// Config\nconst ENABLE_EXPLICIT_PORTS = true;\n\ntype InteractionMode = \"idle\" | \"drag\" | \"lasso\" | \"edge-create\" | \"resize\";\n\ninterface GraphCanvasProps {\n  graph: GraphModel;\n  onGraphChange: (newGraph: GraphModel) => void;\n  renderNode?: (node: Node, selected: boolean) => React.ReactNode;\n  renderContainer?: (container: Container, collapsed: boolean) => React.ReactNode;\n}\n\nexport const GraphCanvas = ({ graph, onGraphChange, renderNode, renderContainer }: GraphCanvasProps) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // State\n  const [selectedNodes, setSelectedNodes] = useState<Set<ID>>(new Set());\n  const [selectedContainerIds, setSelectedContainerIds] = useState<Set<ID>>(new Set());\n  const [mode, setMode] = useState<InteractionMode>(\"idle\");\n  const [dragStartMouse, setDragStartMouse] = useState<Vec2 | null>(null);\n  const [dragStartPositions, setDragStartPositions] = useState<Map<ID, Vec2>>(new Map());\n  const [lassoStart, setLassoStart] = useState<Vec2 | null>(null);\n  const [lassoEnd, setLassoEnd] = useState<Vec2 | null>(null);\n  const [creatingEdge, setCreatingEdge] = useState<{sourceNodeId: ID; sourcePortId?: ID; position: Vec2} | null>(null);\n  const [canvasMenu, setCanvasMenu] = useState<{ targetId?: ID; type?: string; position: Vec2 } | null>(null);\n  const [resizingState, setResizingState] = useState<{ id: ID; startMouse: Vec2; startSize: { width: number; height: number };} | null>(null);\n  \n  // Port State\n  const [hoveredPort, setHoveredPort] = useState<{nodeId: ID, portId: ID } | null>(null);\n  const [dragStartPortId, setDragStartPortId] = useState<ID | null>(null);\n  const [pendingSourcePortLabel, setPendingSourcePortLabel] = useState<string | null>(null);\n\n  // Editor State\n  const [editingEntityId, setEditingEntityId] = useState<string | null>(null);\n  const [editorPosition, setEditorPosition] = useState<{x: number, y: number} | null>(null);\n\n  const getMousePos = (e: React.MouseEvent): Vec2 => {\n    const rect = containerRef.current!.getBoundingClientRect();\n    return { x: e.clientX - rect.left, y: e.clientY - rect.top };\n  };\n\n  const clearAllStates = () => {\n    setSelectedNodes(new Set());\n    setSelectedContainerIds(new Set());\n    setCanvasMenu(null);\n  };\n\n  // --- Rendering Helpers ---\n\n  const renderPorts = (entity: Node | Container) => {\n    // USE LOGIC: Calculate which ports to show (proxies or real)\n    const portsToRender = \"nodeIds\" in entity \n      ? GraphLogic.getRenderablePorts(graph, entity as Container)\n      : (entity.ports || []);\n\n    return portsToRender.map((port) => {\n      // Geometry Calculation\n      const pos = getPortPosition(\n          entity, \n          port.id, \n          graph, \n          \"nodeIds\" in entity ? (entity as Container).size : { width: 100, height: 50 }\n      );\n      return (\n        <div\n          key={port.id}\n          title={port.label}\n          style={{\n            position: \"absolute\",\n            left: pos.x - 6, top: pos.y - 6,\n            width: 12, height: 12, borderRadius: \"50%\",\n            backgroundColor: \"#fff\", border: \"2px solid #333\",\n            zIndex: 100, cursor: \"pointer\",\n          }}\n          onMouseEnter={() => setHoveredPort({ nodeId: entity.id, portId: port.id })}\n          onMouseLeave={() => setHoveredPort(null)}\n          onMouseDown={(e) => {\n            e.stopPropagation();\n            setCreatingEdge({ sourceNodeId: entity.id, position: pos}); \n            setDragStartPortId(port.id);\n            setPendingSourcePortLabel(port.label); \n            setMode(\"edge-create\");\n            setDragStartMouse(getMousePos(e));\n          }}\n        />\n      );\n    });\n  };\n\n  // --- Event Handlers ---\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    const pos = getMousePos(e);\n\n    // 1. Port Interaction\n    if (ENABLE_EXPLICIT_PORTS && hoveredPort) {\n        // Logic handled in renderPorts onMouseDown\n        return;\n    }\n\n    // 2. Right Click\n    if (e.button === 2 && e.target === e.currentTarget) {\n        e.preventDefault();\n        setCanvasMenu({ position: { x: e.clientX, y: e.clientY } }); \n        return;\n    }\n\n    // 3. Canvas Click (Clear)\n    if (e.target === e.currentTarget) {\n        clearAllStates();\n        setMode(\"lasso\");\n        setLassoStart(pos);\n        setLassoEnd(pos);\n        setEditingEntityId(null);\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n     // ... (Existing Lasso / Drag Logic, but ensure you call GraphLogic for visibility checks if needed)\n  };\n\n  const handleMouseUp = (e: React.MouseEvent) => {\n    const pos = getMousePos(e);\n\n    if (mode === \"edge-create\" && creatingEdge) {\n        // USE LOGIC: Hit test via the helper\n        let targetNodeId = hoveredPort ? hoveredPort.nodeId : GraphLogic.hitTestEntity(graph, pos);\n        let targetPortId = hoveredPort ? hoveredPort.portId : null;\n\n        if (targetNodeId && targetNodeId !== creatingEdge.sourceNodeId) {\n             // ... Perform your edge creation logic here ...\n             // (This is where you'd use graph.addEdge)\n             // Check if explicit ports are enabled, create ports if missing, etc.\n             const newGraph = graph.clone();\n             \n             // Example simple edge add for brevity (Replace with your robust logic):\n             const edgeId = `e_${crypto.randomUUID()}`;\n             newGraph.addEdge({\n                 id: edgeId,\n                 sourceNodeId: creatingEdge.sourceNodeId,    // <--- Fixed\n                 sourcePortId: creatingEdge.sourcePortId,\n                 targetNodeId: targetNodeId,                 // <--- Fixed\n                 targetPortId: targetPortId || undefined\n             });\n             onGraphChange(newGraph);\n        }\n        setCreatingEdge(null);\n        setMode(\"idle\");\n    }\n\n    if (mode === \"drag\") {\n        // USE LOGIC: When dropping, check containment\n        const newGraph = graph.clone();\n        \n        // Check every node/container that was dragged\n        // We only check the \"roots\" of the drag to avoid double processing\n        dragStartPositions.forEach((_, id) => {\n             GraphLogic.assignEntityToContainer(newGraph, id);\n             // Also recompute sizes of parents that might have grown\n             const parent = newGraph.nodesById[id]?.parentId || newGraph.containersById[id]?.parentId;\n             if(parent) GraphLogic.recomputeContainerSize(newGraph, parent);\n        });\n        \n        onGraphChange(newGraph);\n        setMode(\"idle\");\n        setDragStartMouse(null);\n        setDragStartPositions(new Map());\n    }\n    \n    // ... Lasso cleanup ...\n  };\n\n  return (\n    <div \n        ref={containerRef} \n        className=\"graph-canvas\" \n        style={{ position: \"relative\", width: \"100%\", height: \"100%\", overflow: \"hidden\", userSelect: \"none\" }}\n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onContextMenu={(e) => e.preventDefault()}\n    >\n{Object.values(graph.containersById).map(c => {\n    if (!GraphLogic.isEntityVisible(graph, c.id)) return null;\n    return (\n        <React.Fragment key={c.id}>\n            <GraphContainer \n                container={c}\n                selected={selectedContainerIds.has(c.id)}\n                onMouseDown={(e) => {\n                    e.stopPropagation();\n                    // Select logic\n                    if (!e.shiftKey) {\n                        setSelectedNodes(new Set());\n                        setSelectedContainerIds(new Set([c.id]));\n                    } else {\n                        const newSet = new Set(selectedContainerIds);\n                        newSet.has(c.id) ? newSet.delete(c.id) : newSet.add(c.id);\n                        setSelectedContainerIds(newSet);\n                    }\n                    // Start dragging\n                    setMode(\"drag\");\n                    setDragStartMouse(getMousePos(e));\n                    setDragStartPositions(GraphLogic.collectDragStartPositions([c.id], new Map(), graph));\n                }}\n                onDoubleClick={(e) => {\n                    e.stopPropagation();\n                    setEditingEntityId(c.id);\n                    setEditorPosition({ x: e.clientX, y: e.clientY });\n                }}\n                onContextMenu={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    setCanvasMenu({ targetId: c.id, type: \"container\", position: { x: e.clientX, y: e.clientY } });\n                }}\n            >\n                {renderPorts(c)}\n            </GraphContainer>\n        </React.Fragment>\n    )\n})}\n\n        {Object.values(graph.nodesById).map(n => {\n            if (!GraphLogic.isEntityVisible(graph, n.id)) return null;\n            return (\n                    <React.Fragment key={n.id}>\n                    <GraphNode \n                        node={n}\n                        selected={selectedNodes.has(n.id)}\n                        onMouseDown={(e) => {\n                            e.stopPropagation();\n                            // Select logic\n                            if (!e.shiftKey) {\n                                setSelectedContainerIds(new Set());\n                                setSelectedNodes(new Set([n.id]));\n                            } else {\n                                const newSet = new Set(selectedNodes);\n                                newSet.has(n.id) ? newSet.delete(n.id) : newSet.add(n.id);\n                                setSelectedNodes(newSet);\n                            }\n                            \n                            // Right click check for menu\n                            if (e.button === 2) {\n                                setCanvasMenu({ targetId: n.id, type: \"node\", position: { x: e.clientX, y: e.clientY } });\n                                return;\n                            }\n\n                            // Start dragging\n                            setMode(\"drag\");\n                            setDragStartMouse(getMousePos(e));\n                            setDragStartPositions(GraphLogic.collectDragStartPositions([n.id], new Map(), graph));\n                        }}\n                        onDoubleClick={(e) => {\n                            e.stopPropagation();\n                            setEditingEntityId(n.id);\n                            setEditorPosition({ x: e.clientX, y: e.clientY });\n                        }}\n                    />\n                    {renderPorts(n)}\n                    </React.Fragment>\n            )\n        })}\n\n        {/* Edges, Lasso, EntityEditor, etc */}\n        {editingEntityId && editorPosition && (\n             <EntityEditor \n                entityId={editingEntityId}\n                graph={graph}\n                position={editorPosition}\n                onClose={() => setEditingEntityId(null)}\n                onGraphChange={onGraphChange}\n             />\n        )}\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}