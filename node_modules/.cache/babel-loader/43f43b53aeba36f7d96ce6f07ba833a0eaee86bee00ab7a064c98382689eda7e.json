{"ast":null,"code":"var _jsxFileName = \"/home/belac/sysFlow/src/components/GraphContextMenu.tsx\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { ContextMenu } from \"./ContextMenu\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const GraphContextMenu = ({\n  canvasMenu,\n  graph,\n  onGraphChange,\n  onClose\n}) => {\n  if (!canvasMenu) return null;\n\n  // Fallback to position if graphPosition is missing\n  const insertionPos = canvasMenu.graphPosition || canvasMenu.position;\n  const getOptions = () => {\n    // 1. CANVAS (Background)\n    if (!canvasMenu.targetId) {\n      return [{\n        label: \"Add Node\",\n        onClick: () => {\n          const newGraph = graph.clone();\n          const id = `n_${crypto.randomUUID().slice(0, 4)}`;\n          newGraph.addNode({\n            id,\n            label: \"New Node\",\n            position: insertionPos,\n            // <--- USE INSERTION POS\n            ports: [],\n            size: {\n              width: 100,\n              height: 50\n            }\n          });\n          onGraphChange(newGraph);\n          onClose();\n        }\n      }, {\n        label: \"Add Container\",\n        onClick: () => {\n          const newGraph = graph.clone();\n          const id = `c_${crypto.randomUUID().slice(0, 4)}`;\n          newGraph.addContainer({\n            id,\n            label: \"New Container\",\n            position: insertionPos,\n            // <--- USE INSERTION POS\n            size: {\n              width: 300,\n              height: 200\n            },\n            nodeIds: [],\n            childContainerIds: [],\n            collapsed: false\n          });\n          onGraphChange(newGraph);\n          onClose();\n        }\n      }];\n    }\n    return [];\n  };\n\n  // 2. Render via Portal\n  return /*#__PURE__*/ReactDOM.createPortal(/*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"fixed\",\n        inset: 0,\n        zIndex: 9998\n      },\n      onMouseDown: e => {\n        e.stopPropagation();\n        onClose();\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"fixed\",\n        top: canvasMenu.position.y,\n        left: canvasMenu.position.x,\n        zIndex: 9999,\n        // Ensure this div doesn't add extra size/margin\n        margin: 0,\n        padding: 0,\n        transform: \"none\"\n      },\n      children: /*#__PURE__*/_jsxDEV(ContextMenu, {\n        position: {\n          x: 0,\n          y: 0\n        },\n        options: options\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true), document.body);\n};\n_c = GraphContextMenu;\nvar _c;\n$RefreshReg$(_c, \"GraphContextMenu\");","map":{"version":3,"names":["React","ReactDOM","ContextMenu","jsxDEV","_jsxDEV","Fragment","_Fragment","GraphContextMenu","canvasMenu","graph","onGraphChange","onClose","insertionPos","graphPosition","position","getOptions","targetId","label","onClick","newGraph","clone","id","crypto","randomUUID","slice","addNode","ports","size","width","height","addContainer","nodeIds","childContainerIds","collapsed","createPortal","children","style","inset","zIndex","onMouseDown","e","stopPropagation","fileName","_jsxFileName","lineNumber","columnNumber","top","y","left","x","margin","padding","transform","options","document","body","_c","$RefreshReg$"],"sources":["/home/belac/sysFlow/src/components/GraphContextMenu.tsx"],"sourcesContent":["import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { ContextMenu } from \"./ContextMenu\";\n\nexport interface CanvasMenuState {\n  targetId?: string | null;\n  position: { x: number; y: number };      // Screen Coords\n  graphPosition?: { x: number; y: number }; // Graph Coords (Optional for backward compat)\n}\n\ninterface GraphContextMenuProps {\n  canvasMenu: CanvasMenuState | null;\n  graph: any;\n  onGraphChange: (newGraph: any) => void;\n  onClose: () => void;\n}\n\nexport const GraphContextMenu: React.FC<GraphContextMenuProps> = ({\n  canvasMenu,\n  graph,\n  onGraphChange,\n  onClose,\n}) => {\n  if (!canvasMenu) return null;\n\n  // Fallback to position if graphPosition is missing\n  const insertionPos = canvasMenu.graphPosition || canvasMenu.position;\n\n  const getOptions = () => {\n    // 1. CANVAS (Background)\n    if (!canvasMenu.targetId) {\n      return [\n        {\n          label: \"Add Node\",\n          onClick: () => {\n            const newGraph = graph.clone();\n            const id = `n_${crypto.randomUUID().slice(0, 4)}`;\n            newGraph.addNode({\n              id,\n              label: \"New Node\",\n              position: insertionPos, // <--- USE INSERTION POS\n              ports: [],\n              size: { width: 100, height: 50 },\n            });\n            onGraphChange(newGraph);\n            onClose();\n          },\n        },\n        {\n          label: \"Add Container\",\n          onClick: () => {\n            const newGraph = graph.clone();\n            const id = `c_${crypto.randomUUID().slice(0, 4)}`;\n            newGraph.addContainer({\n              id,\n              label: \"New Container\",\n              position: insertionPos, // <--- USE INSERTION POS\n              size: { width: 300, height: 200 },\n              nodeIds: [],\n              childContainerIds: [],\n              collapsed: false,\n            });\n            onGraphChange(newGraph);\n            onClose();\n          },\n        },\n      ];\n    }\n    return [];\n  };\n\n// 2. Render via Portal\n  return ReactDOM.createPortal(\n    <>\n      {/* Click Shield */}\n      <div \n        style={{ position: \"fixed\", inset: 0, zIndex: 9998 }} \n        onMouseDown={(e) => { e.stopPropagation(); onClose(); }} \n      />\n\n      {/* 3. THE WRAPPER: Handles the Real Positioning */}\n      <div\n        style={{\n          position: \"fixed\",\n          top: canvasMenu.position.y,\n          left: canvasMenu.position.x,\n          zIndex: 9999,\n          // Ensure this div doesn't add extra size/margin\n          margin: 0,\n          padding: 0,\n          transform: \"none\", \n        }}\n      >\n        {/* 4. THE FIX: Pass ZERO to the inner component \n            We force the inner component to render at 0,0 relative to this wrapper. \n        */}\n        <ContextMenu \n            position={{ x: 0, y: 0 }} \n            options={options} \n        />\n      </div>\n    </>,\n    document.body\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}