{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useCallback, useEffect, useRef } from \"react\";\nexport const useGraphView = containerRef => {\n  _s();\n  const [view, setView] = useState({\n    x: 0,\n    y: 0,\n    zoom: 1\n  });\n  const [isPanning, setIsPanning] = useState(false);\n  const [panStartMouse, setPanStartMouse] = useState(null);\n\n  // 1. Keep a Ref of the view so our non-React event listener can read it\n  //    without needing to re-bind the listener on every render.\n  const viewRef = useRef(view);\n\n  // Sync the Ref whenever state changes\n  useEffect(() => {\n    viewRef.current = view;\n  }, [view]);\n\n  // 2. The Native Wheel Listener (Non-Passive)\n  useEffect(() => {\n    const el = containerRef.current;\n    if (!el) return;\n    const onWheel = e => {\n      // Access the *current* view from the ref, not the stale closure\n      const currentView = viewRef.current;\n\n      // Ctrl+Scroll -> Zoom\n      if (e.ctrlKey || e.metaKey) {\n        e.preventDefault(); // STOP the browser from zooming the whole page\n\n        const rect = el.getBoundingClientRect();\n        const screenX = e.clientX - rect.left;\n        const screenY = e.clientY - rect.top;\n\n        // World position before zoom\n        const worldX = (screenX - currentView.x) / currentView.zoom;\n        const worldY = (screenY - currentView.y) / currentView.zoom;\n\n        // Calc new zoom\n        const delta = -e.deltaY * 0.001;\n        const newZoom = Math.min(Math.max(0.1, currentView.zoom * (1 + delta)), 5);\n\n        // Adjust Pan to keep mouse over same world point\n        const newX = screenX - worldX * newZoom;\n        const newY = screenY - worldY * newZoom;\n        setView({\n          x: newX,\n          y: newY,\n          zoom: newZoom\n        });\n      } else {\n        // Standard Pan (Shift+Scroll or Trackpad)\n        // Only prevent default if we are actually panning to avoid blocking normal page scroll\n        // (Optional: remove e.preventDefault() here if you want normal scroll behavior when not zooming)\n        e.preventDefault();\n        setView(prev => ({\n          ...prev,\n          x: prev.x - e.deltaX,\n          y: prev.y - e.deltaY\n        }));\n      }\n    };\n\n    // 3. Attach with { passive: false }\n    el.addEventListener(\"wheel\", onWheel, {\n      passive: false\n    });\n    return () => {\n      el.removeEventListener(\"wheel\", onWheel);\n    };\n  }, [containerRef]); // Only run once on mount (or if ref changes)\n\n  // --- Helper: Convert Screen (Mouse) coords to World (Graph) coords ---\n  const getGlobPos = useCallback(e => {\n    if (!containerRef.current) return {\n      x: 0,\n      y: 0\n    };\n    const rect = containerRef.current.getBoundingClientRect();\n    return {\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top\n    };\n  }, [containerRef]); // removed 'view' dependency to prevent unnecessary recalcs\n\n  const getMousePos = useCallback(e => {\n    const glob = getGlobPos(e);\n    return {\n      x: (glob.x - view.x) / view.zoom,\n      y: (glob.y - view.y) / view.zoom\n    };\n  }, [view, getGlobPos]);\n\n  // --- Manual Panning Handlers (Middle Mouse / Spacebar) ---\n  const startPan = e => {\n    setIsPanning(true);\n    setPanStartMouse({\n      x: e.clientX,\n      y: e.clientY\n    });\n  };\n  const updatePan = e => {\n    if (!isPanning || !panStartMouse) return;\n    const dx = e.clientX - panStartMouse.x;\n    const dy = e.clientY - panStartMouse.y;\n    setView(prev => ({\n      ...prev,\n      x: prev.x + dx,\n      y: prev.y + dy\n    }));\n    setPanStartMouse({\n      x: e.clientX,\n      y: e.clientY\n    });\n  };\n  const endPan = () => {\n    setIsPanning(false);\n    setPanStartMouse(null);\n  };\n  return {\n    view,\n    setView,\n    isPanning,\n    getMousePos,\n    getGlobPos,\n    // handleWheel, <-- REMOVED (Handled internally now)\n    startPan,\n    updatePan,\n    endPan\n  };\n};\n_s(useGraphView, \"jxqdM7x0rim0OQW8Tf7LQwq/Oq4=\");","map":{"version":3,"names":["useState","useCallback","useEffect","useRef","useGraphView","containerRef","_s","view","setView","x","y","zoom","isPanning","setIsPanning","panStartMouse","setPanStartMouse","viewRef","current","el","onWheel","e","currentView","ctrlKey","metaKey","preventDefault","rect","getBoundingClientRect","screenX","clientX","left","screenY","clientY","top","worldX","worldY","delta","deltaY","newZoom","Math","min","max","newX","newY","prev","deltaX","addEventListener","passive","removeEventListener","getGlobPos","getMousePos","glob","startPan","updatePan","dx","dy","endPan"],"sources":["/home/belac/sysFlow/src/hooks/useGraphView.ts"],"sourcesContent":["import { useState, useCallback, useEffect, useRef } from \"react\";\nimport { Vec2 } from \"../models/Entity\";\n\nexport const useGraphView = (containerRef: React.RefObject<HTMLDivElement | null>) => {\n  const [view, setView] = useState({ x: 0, y: 0, zoom: 1 });\n  const [isPanning, setIsPanning] = useState(false);\n  const [panStartMouse, setPanStartMouse] = useState<Vec2 | null>(null);\n\n  // 1. Keep a Ref of the view so our non-React event listener can read it\n  //    without needing to re-bind the listener on every render.\n  const viewRef = useRef(view);\n  \n  // Sync the Ref whenever state changes\n  useEffect(() => {\n    viewRef.current = view;\n  }, [view]);\n\n  // 2. The Native Wheel Listener (Non-Passive)\n  useEffect(() => {\n    const el = containerRef.current;\n    if (!el) return;\n\n    const onWheel = (e: WheelEvent) => {\n      // Access the *current* view from the ref, not the stale closure\n      const currentView = viewRef.current;\n\n      // Ctrl+Scroll -> Zoom\n      if (e.ctrlKey || e.metaKey) {\n        e.preventDefault(); // STOP the browser from zooming the whole page\n\n        const rect = el.getBoundingClientRect();\n        const screenX = e.clientX - rect.left;\n        const screenY = e.clientY - rect.top;\n\n        // World position before zoom\n        const worldX = (screenX - currentView.x) / currentView.zoom;\n        const worldY = (screenY - currentView.y) / currentView.zoom;\n\n        // Calc new zoom\n        const delta = -e.deltaY * 0.001;\n        const newZoom = Math.min(Math.max(0.1, currentView.zoom * (1 + delta)), 5);\n\n        // Adjust Pan to keep mouse over same world point\n        const newX = screenX - (worldX * newZoom);\n        const newY = screenY - (worldY * newZoom);\n\n        setView({ x: newX, y: newY, zoom: newZoom });\n      } else {\n        // Standard Pan (Shift+Scroll or Trackpad)\n        // Only prevent default if we are actually panning to avoid blocking normal page scroll\n        // (Optional: remove e.preventDefault() here if you want normal scroll behavior when not zooming)\n        e.preventDefault(); \n        \n        setView(prev => ({\n          ...prev,\n          x: prev.x - e.deltaX,\n          y: prev.y - e.deltaY\n        }));\n      }\n    };\n\n    // 3. Attach with { passive: false }\n    el.addEventListener(\"wheel\", onWheel, { passive: false });\n\n    return () => {\n      el.removeEventListener(\"wheel\", onWheel);\n    };\n  }, [containerRef]); // Only run once on mount (or if ref changes)\n\n\n  // --- Helper: Convert Screen (Mouse) coords to World (Graph) coords ---\n  const getGlobPos = useCallback((e: React.MouseEvent | MouseEvent): Vec2 => {\n    if (!containerRef.current) return { x: 0, y: 0 };\n    const rect = containerRef.current.getBoundingClientRect();\n    return { \n      x: e.clientX - rect.left, \n      y: e.clientY - rect.top\n    };\n  }, [containerRef]); // removed 'view' dependency to prevent unnecessary recalcs\n\n  const getMousePos = useCallback((e: React.MouseEvent | MouseEvent): Vec2 => {\n    const glob = getGlobPos(e);\n    return {\n      x: (glob.x - view.x) / view.zoom,\n      y: (glob.y - view.y) / view.zoom\n    };\n  }, [view, getGlobPos]);\n\n\n  // --- Manual Panning Handlers (Middle Mouse / Spacebar) ---\n  const startPan = (e: React.MouseEvent) => {\n    setIsPanning(true);\n    setPanStartMouse({ x: e.clientX, y: e.clientY });\n  };\n\n  const updatePan = (e: React.MouseEvent) => {\n    if (!isPanning || !panStartMouse) return;\n    const dx = e.clientX - panStartMouse.x;\n    const dy = e.clientY - panStartMouse.y;\n    setView(prev => ({ ...prev, x: prev.x + dx, y: prev.y + dy }));\n    setPanStartMouse({ x: e.clientX, y: e.clientY });\n  };\n\n  const endPan = () => {\n    setIsPanning(false);\n    setPanStartMouse(null);\n  };\n\n  return {\n    view,\n    setView,\n    isPanning,\n    getMousePos,\n    getGlobPos,\n    // handleWheel, <-- REMOVED (Handled internally now)\n    startPan,\n    updatePan,\n    endPan\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}