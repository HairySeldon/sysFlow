{"ast":null,"code":"var _jsxFileName = \"/home/belac/sysFlow/src/components/GraphEdgeLayer.tsx\";\nimport React from \"react\";\nimport * as GraphLogic from \"../utils/GraphLogic\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const GraphEdgeLayer = ({\n  graph,\n  mode,\n  creatingEdge,\n  selectedEdgeId,\n  onEdgeClick\n}) => {\n  const getEntity = id => {\n    return graph.nodesById[id] || graph.containersById[id];\n  };\n  const getEntityCenter = entity => {\n    var _entity$size$width, _entity$size, _entity$size$height, _entity$size2;\n    const w = (_entity$size$width = (_entity$size = entity.size) === null || _entity$size === void 0 ? void 0 : _entity$size.width) !== null && _entity$size$width !== void 0 ? _entity$size$width : 100;\n    const h = (_entity$size$height = (_entity$size2 = entity.size) === null || _entity$size2 === void 0 ? void 0 : _entity$size2.height) !== null && _entity$size$height !== void 0 ? _entity$size$height : 50;\n    return {\n      x: entity.position.x + w / 2,\n      y: entity.position.y + h / 2\n    };\n  };\n  const getVisualAnchor = entityId => {\n    // 1. Visible Entity\n    if (GraphLogic.isEntityVisible(graph, entityId)) {\n      const entity = getEntity(entityId);\n      return entity ? getEntityCenter(entity) : null;\n    }\n    // 2. Collapsed Parent\n    const containers = Object.values(graph.containersById);\n    const parent = containers.find(c => {\n      var _c$nodeIds, _c$childContainerIds;\n      return ((_c$nodeIds = c.nodeIds) === null || _c$nodeIds === void 0 ? void 0 : _c$nodeIds.includes(entityId)) || ((_c$childContainerIds = c.childContainerIds) === null || _c$childContainerIds === void 0 ? void 0 : _c$childContainerIds.includes(entityId));\n    });\n    if (parent && GraphLogic.isEntityVisible(graph, parent.id)) {\n      return getEntityCenter(parent);\n    }\n    return null;\n  };\n  return /*#__PURE__*/_jsxDEV(\"svg\", {\n    style: {\n      position: \"absolute\",\n      top: 0,\n      left: 0,\n      width: \"100%\",\n      height: \"100%\",\n      pointerEvents: \"none\",\n      // Let clicks pass through empty space\n      overflow: \"visible\",\n      zIndex: 0\n    },\n    children: [Object.values(graph.edgesById).map(edge => {\n      const start = getVisualAnchor(edge.sourceNodeId);\n      const end = getVisualAnchor(edge.targetNodeId);\n      if (!start || !end) return null;\n      const isSelected = selectedEdgeId === edge.id;\n      const midX = (start.x + end.x) / 2;\n      const midY = (start.y + end.y) / 2;\n      return /*#__PURE__*/_jsxDEV(\"g\", {\n        style: {\n          pointerEvents: \"all\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"line\", {\n          x1: start.x,\n          y1: start.y,\n          x2: end.x,\n          y2: end.y,\n          stroke: \"transparent\",\n          strokeWidth: \"15\",\n          cursor: \"pointer\",\n          onClick: e => {\n            e.stopPropagation();\n            onEdgeClick(e, edge.id);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"line\", {\n          x1: start.x,\n          y1: start.y,\n          x2: end.x,\n          y2: end.y,\n          stroke: isSelected ? \"#3366ff\" : \"black\",\n          strokeWidth: isSelected ? \"3\" : \"2\",\n          pointerEvents: \"none\" // Click goes through to the Hit Area\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }, this), edge.label && /*#__PURE__*/_jsxDEV(\"g\", {\n          transform: `translate(${midX}, ${midY})`,\n          children: [/*#__PURE__*/_jsxDEV(\"rect\", {\n            x: -(edge.label.length * 4) - 4,\n            y: -10,\n            width: edge.label.length * 8 + 8,\n            height: 20,\n            fill: \"white\",\n            rx: \"4\",\n            stroke: isSelected ? \"#3366ff\" : \"#ccc\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 18\n          }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n            x: 0,\n            y: 4,\n            textAnchor: \"middle\",\n            fontSize: \"12\",\n            fill: isSelected ? \"#3366ff\" : \"black\",\n            style: {\n              userSelect: \"none\"\n            },\n            children: edge.label\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 18\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 15\n        }, this)]\n      }, edge.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 11\n      }, this);\n    }), mode === \"edge-create\" && creatingEdge && /*#__PURE__*/_jsxDEV(\"line\", {\n      x1: creatingEdge.position.x,\n      y1: creatingEdge.position.y,\n      x2: (() => {\n        const source = getEntity(creatingEdge.sourceNodeId);\n        return source ? getEntityCenter(source).x : creatingEdge.position.x;\n      })(),\n      y2: (() => {\n        const source = getEntity(creatingEdge.sourceNodeId);\n        return source ? getEntityCenter(source).y : creatingEdge.position.y;\n      })(),\n      stroke: \"black\",\n      strokeWidth: \"2\",\n      strokeDasharray: \"5,5\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 60,\n    columnNumber: 5\n  }, this);\n};\n_c = GraphEdgeLayer;\nvar _c;\n$RefreshReg$(_c, \"GraphEdgeLayer\");","map":{"version":3,"names":["React","GraphLogic","jsxDEV","_jsxDEV","GraphEdgeLayer","graph","mode","creatingEdge","selectedEdgeId","onEdgeClick","getEntity","id","nodesById","containersById","getEntityCenter","entity","_entity$size$width","_entity$size","_entity$size$height","_entity$size2","w","size","width","h","height","x","position","y","getVisualAnchor","entityId","isEntityVisible","containers","Object","values","parent","find","c","_c$nodeIds","_c$childContainerIds","nodeIds","includes","childContainerIds","style","top","left","pointerEvents","overflow","zIndex","children","edgesById","map","edge","start","sourceNodeId","end","targetNodeId","isSelected","midX","midY","x1","y1","x2","y2","stroke","strokeWidth","cursor","onClick","e","stopPropagation","fileName","_jsxFileName","lineNumber","columnNumber","label","transform","length","fill","rx","textAnchor","fontSize","userSelect","source","strokeDasharray","_c","$RefreshReg$"],"sources":["/home/belac/sysFlow/src/components/GraphEdgeLayer.tsx"],"sourcesContent":["import React from \"react\";\nimport { Vec2 } from \"../models/Entity\";\nimport * as GraphLogic from \"../utils/GraphLogic\";\n\ninterface EntityShape {\n  id: string;\n  position: Vec2;\n  size?: { width: number; height: number };\n  nodeIds?: string[];\n  childContainerIds?: string[];\n}\n\ninterface GraphEdgeLayerProps {\n  graph: any;\n  mode: string;\n  creatingEdge: { sourceNodeId: string; position: Vec2 } | null;\n  selectedEdgeId: string | null; // NEW\n  onEdgeClick: (e: React.MouseEvent, edgeId: string) => void; // NEW\n}\n\nexport const GraphEdgeLayer: React.FC<GraphEdgeLayerProps> = ({\n  graph,\n  mode,\n  creatingEdge,\n  selectedEdgeId,\n  onEdgeClick\n}) => {\n\n  const getEntity = (id: string): EntityShape | undefined => {\n    return graph.nodesById[id] || graph.containersById[id];\n  };\n\n  const getEntityCenter = (entity: EntityShape) => {\n    const w = entity.size?.width ?? 100;\n    const h = entity.size?.height ?? 50;\n    return {\n      x: entity.position.x + w / 2,\n      y: entity.position.y + h / 2\n    };\n  };\n\n  const getVisualAnchor = (entityId: string): Vec2 | null => {\n    // 1. Visible Entity\n    if (GraphLogic.isEntityVisible(graph, entityId)) {\n      const entity = getEntity(entityId);\n      return entity ? getEntityCenter(entity) : null;\n    }\n    // 2. Collapsed Parent\n    const containers: EntityShape[] = Object.values(graph.containersById);\n    const parent = containers.find((c) =>\n      c.nodeIds?.includes(entityId) || c.childContainerIds?.includes(entityId)\n    );\n    if (parent && GraphLogic.isEntityVisible(graph, parent.id)) {\n      return getEntityCenter(parent);\n    }\n    return null;\n  };\n\n  return (\n    <svg\n      style={{\n        position: \"absolute\",\n        top: 0,\n        left: 0,\n        width: \"100%\",\n        height: \"100%\",\n        pointerEvents: \"none\", // Let clicks pass through empty space\n        overflow: \"visible\",\n        zIndex: 0,\n      }}\n    >\n      {/* 1. Render Existing Edges */}\n      {Object.values(graph.edgesById).map((edge: any) => {\n        const start = getVisualAnchor(edge.sourceNodeId);\n        const end = getVisualAnchor(edge.targetNodeId);\n\n        if (!start || !end) return null;\n\n        const isSelected = selectedEdgeId === edge.id;\n        const midX = (start.x + end.x) / 2;\n        const midY = (start.y + end.y) / 2;\n\n        return (\n          <g key={edge.id} style={{ pointerEvents: \"all\" }}> \n            {/* A. Thick Invisible Hit Area (makes clicking easier) */}\n            <line\n              x1={start.x} y1={start.y} x2={end.x} y2={end.y}\n              stroke=\"transparent\"\n              strokeWidth=\"15\"\n              cursor=\"pointer\"\n              onClick={(e) => {\n                 e.stopPropagation();\n                 onEdgeClick(e, edge.id);\n              }}\n            />\n\n            {/* B. Visible Line */}\n            <line\n              x1={start.x} y1={start.y} x2={end.x} y2={end.y}\n              stroke={isSelected ? \"#3366ff\" : \"black\"}\n              strokeWidth={isSelected ? \"3\" : \"2\"}\n              pointerEvents=\"none\" // Click goes through to the Hit Area\n            />\n\n            {/* C. Label (Background + Text) */}\n            {edge.label && (\n              <g transform={`translate(${midX}, ${midY})`}>\n                 <rect \n                    x={-(edge.label.length * 4) - 4} \n                    y={-10} \n                    width={(edge.label.length * 8) + 8} \n                    height={20} \n                    fill=\"white\" \n                    rx=\"4\"\n                    stroke={isSelected ? \"#3366ff\" : \"#ccc\"}\n                 />\n                 <text\n                    x={0} y={4}\n                    textAnchor=\"middle\"\n                    fontSize=\"12\"\n                    fill={isSelected ? \"#3366ff\" : \"black\"}\n                    style={{ userSelect: \"none\" }}\n                 >\n                   {edge.label}\n                 </text>\n              </g>\n            )}\n          </g>\n        );\n      })}\n\n      {/* 2. Creating Edge (No changes) */}\n      {mode === \"edge-create\" && creatingEdge && (\n        <line\n          x1={creatingEdge.position.x}\n          y1={creatingEdge.position.y}\n          x2={(() => {\n            const source = getEntity(creatingEdge.sourceNodeId);\n            return source ? getEntityCenter(source).x : creatingEdge.position.x;\n          })()}\n          y2={(() => {\n             const source = getEntity(creatingEdge.sourceNodeId);\n             return source ? getEntityCenter(source).y : creatingEdge.position.y;\n          })()}\n          stroke=\"black\"\n          strokeWidth=\"2\"\n          strokeDasharray=\"5,5\"\n        />\n      )}\n    </svg>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}